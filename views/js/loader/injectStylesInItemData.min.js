(function(){"use strict";var loaderScript=document.getElementById("amd-loader"),configUrl=loaderScript.getAttribute("data-config"),bundle=loaderScript.getAttribute("data-bundle"),loadController=function loadController(){var controllerOptions={},controllerPath=loaderScript.getAttribute("data-controller"),params=loaderScript.getAttribute("data-params");try{controllerOptions=JSON.parse(params)}catch(err){controllerOptions={}}window.require([controllerPath],function(controller){var startController=function startController(){window.started||(window.started=!0,controller.start(controllerOptions))};document.addEventListener("readystatechange",startController,!1),"complete"===document.readyState&&startController()})};window.require([configUrl],function(){window.loadBundles||(window.loaded={},window.loadBundles=function loadBundles(bundles){bundles=bundles||[],bundles=bundles.concat(window.bundles),bundles=bundles.filter(function(item,index){return item&&bundles.indexOf(item)===index&&!0!==window.loaded[item]}),require(bundles,function(){bundles.forEach(function(item){window.loaded[item]=!0}),loadController()})}),bundle||window.bundles&&window.bundles.length?window.loadBundles([bundle]):loadController()})})(),define("loader/bootstrap",function(){}),define("taoMediaManager/richPassage/helpers",["lodash","uri","util/url","core/dataProvider/request"],function(_,uri,urlUtil,request){"use strict";function getPassagesFromElement(){let element=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},includes={};return _.forEach(["elements","choices"],elementCollection=>{"choices"===elementCollection&&_.isArray(element[elementCollection])?_.forEach(element[elementCollection],choiceMatch=>{_.forEach(choiceMatch,choice=>{includes=_.extend(includes,getPassagesFromElement(choice))})}):_.forEach(element[elementCollection],childElement=>{"include"===childElement.qtiClass?includes[childElement.serial]=childElement:includes=_.extend(includes,getPassagesFromElement(childElement))})}),element.body&&(includes=_.extend(includes,getPassagesFromElement(element.body))),element.prompt&&(includes=_.extend(includes,getPassagesFromElement(element.prompt))),includes}function getPassagesFromItemData(){let itemData=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},includes={};return itemData.content&&itemData.content.data&&itemData.content.data.body&&(includes=_.extend(includes,getPassagesFromElement(itemData.content.data.body))),includes}function injectPassagesStylesInItemData(){let elements=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},itemData=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};const requests=[],passageUris=[];return _.forEach(elements,(elem,id)=>{const passageHref=elem.attributes.href;if(/taomedia:\/\/mediamanager\//.test(passageHref)){const passageUri=uri.decode(passageHref.replace("taomedia://mediamanager/",""));passageUris.includes(passageUri)||(passageUris.push(passageUri),requests.push(request(urlUtil.route("getStylesheets","SharedStimulusStyling","taoMediaManager"),{uri:passageUri}).then(response=>{response.forEach((element,index)=>{const serial=`stylesheet_${id}_${index}`;itemData.content.data.stylesheets[serial]={qtiClass:"stylesheet",attributes:{href:urlUtil.route("loadStylesheet","SharedStimulusStyling","taoMediaManager",{uri:passageUri,stylesheet:element}),media:"all",title:"",type:"text/css"},serial}})}).catch()))}}),Promise.all(requests).then(()=>itemData)}function checkAndInjectStylesInItemData(){let itemData=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};const itemDataString=JSON.stringify(itemData);if(/"qtiClass":"include"/.test(itemDataString)){const elements=getPassagesFromItemData(itemData);return injectPassagesStylesInItemData(elements,itemData)}return Promise.resolve(itemData)}return{getPassagesFromElement,getPassagesFromItemData,injectPassagesStylesInItemData,checkAndInjectStylesInItemData}}),define("taoMediaManager/richPassage/injectStylesInItemData",["taoMediaManager/richPassage/helpers"],function(helpers){"use strict";return helpers.checkAndInjectStylesInItemData}),define("taoMediaManager/loader/injectStylesInItemData.bundle",function(){});
//# sourceMappingURL=injectStylesInItemData.min.js.map