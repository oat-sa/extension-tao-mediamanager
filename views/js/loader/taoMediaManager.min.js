define("tpl!taoMediaManager/qtiCreator/tpl/relatedItemsPopup",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<li>"+container.escapeExpression(container.lambda(null==depth0?depth0:lookupProperty(depth0,"label"),depth0))+"</li>"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1,helper;return container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"inUsageMessage")||(null==depth0?depth0:lookupProperty(depth0,"inUsageMessage")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"inUsageMessage",hash:{},data:data,loc:{start:{line:1,column:0},end:{line:1,column:18}}}):helper))+"\n<ul>\n"+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"items"),{name:"each",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:3,column:0},end:{line:3,column:47}}}))?"":stack1)+"\n</ul>\n"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"confirmationMessage")||(null==depth0?depth0:lookupProperty(depth0,"confirmationMessage")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"confirmationMessage",hash:{},data:data,loc:{start:{line:5,column:0},end:{line:5,column:23}}}):helper))},useData:!0})}),define("tpl!taoMediaManager/qtiCreator/tpl/relatedItemsClassPopup",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},helper;return"<b>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Warning",{name:"__",hash:{},data:data,loc:{start:{line:1,column:3},end:{line:1,column:19}}}))+"</b><br><br>\n"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"You are about to delete the class",{name:"__",hash:{},data:data,loc:{start:{line:2,column:0},end:{line:2,column:42}}}))+" <b>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"name")||(null==depth0?depth0:lookupProperty(depth0,"name")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"name",hash:{},data:data,loc:{start:{line:2,column:46},end:{line:2,column:54}}}):helper))+"</b>, "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"which contains assets that are in use elsewhere.",{name:"__",hash:{},data:data,loc:{start:{line:2,column:60},end:{line:2,column:117}}}))+"\n"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Deleting this class will break the items and the tests that are currently using them.",{name:"__",hash:{},data:data,loc:{start:{line:3,column:0},end:{line:3,column:94}}}))+"<br><br>\n"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Are you sure you want to delete this class and all of its content?",{name:"__",hash:{},data:data,loc:{start:{line:4,column:0},end:{line:4,column:75}}}))},useData:!0})}),define("tpl!taoMediaManager/qtiCreator/tpl/forbiddenClassAction",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},helper;return"<b>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Forbidden action",{name:"__",hash:{},data:data,loc:{start:{line:1,column:3},end:{line:1,column:28}}}))+"</b><br><br>\n"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The class",{name:"__",hash:{},data:data,loc:{start:{line:2,column:0},end:{line:2,column:18}}}))+" <b>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"name")||(null==depth0?depth0:lookupProperty(depth0,"name")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"name",hash:{},data:data,loc:{start:{line:2,column:22},end:{line:2,column:30}}}):helper))+"</b> "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"you are trying to delete is too large and contains too many subclasses.",{name:"__",hash:{},data:data,loc:{start:{line:2,column:35},end:{line:2,column:115}}}))+"<br>\n"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Please delete the subclasses before.",{name:"__",hash:{},data:data,loc:{start:{line:3,column:0},end:{line:3,column:45}}}))},useData:!0})}),define("css!taoMediaManagerCss/media",[],function(){}),define("taoMediaManager/controller/actions",["lodash","jquery","i18n","layout/actions/binder","uri","layout/section","core/request","core/router","core/logger","ui/feedback","ui/dialog/confirm","ui/dialog/alert","util/url","tpl!taoMediaManager/qtiCreator/tpl/relatedItemsPopup","tpl!taoMediaManager/qtiCreator/tpl/relatedItemsClassPopup","tpl!taoMediaManager/qtiCreator/tpl/forbiddenClassAction","css!taoMediaManagerCss/media.css"],function(_,$,__,binder,uri,section,request,router,loggerFactory,feedback,confirmDialog,alertDialog,urlUtil,relatedItemsPopupTpl,relatedItemsClassPopupTpl,forbiddenClassActionTpl){"use strict";function callConfirmModal(actionContext,message,url,data,resolve,reject){confirmDialog(message,()=>accept(actionContext,url,data,resolve,reject),()=>cancel(reject))}function callAlertModal(actionContext,message,reject){alertDialog(message,()=>cancel(reject))}function accept(actionContext,url,data,resolve,reject){return request({url:url,method:"POST",data:data,dataType:"json"}).then(function(response){return response.success&&response.deleted?(feedback().success(response.message||__("Resource deleted")),actionContext.tree&&$(actionContext.tree).trigger("removenode.taotree",[{id:actionContext.uri||actionContext.classUri}]),resolve({uri:actionContext.uri||actionContext.classUri})):void(response.success&&!response.deleted&&($(actionContext.tree).trigger("refresh.taotree"),reject(response.msg||response.message||__("Unable to delete the selected resource because you do not have the required rights to delete part of its content."))),reject(response.msg||response.message||__("Unable to delete the selected resource")))})}function cancel(reject){reject({cancel:!0})}const logger=loggerFactory("taoMediaManager/manageMedia");binder.register("newSharedStimulus",function instanciate(actionContext){const self=this,classUri=uri.decode(actionContext.classUri);return request({url:self.url,data:JSON.stringify({classUri:classUri}),method:"POST"}).then(function(response){return actionContext.tree&&$(actionContext.tree).trigger("addnode.taotree",[{uri:uri.decode(response.data.id),label:response.data.name,parent:uri.decode(actionContext.classUri),cssClass:"node-instance"}]),{uri:uri.decode(response.data.id),label:response.data.name,classUri:uri.decode(actionContext.classUri),type:"instance"}}).catch(err=>{_.isUndefined(err.message)||feedback().error(err.message),logger.error(err)})}),binder.register("sharedStimulusAuthoring",function sharedStimulusAuthoring(actionContext){section.updateContentBlock("").create({id:"authoring",name:__("Authoring"),url:this.url,content:" ",visible:!1}).show();const $panel=$("#panel-authoring");$panel.attr("data-id",actionContext.id),$panel.attr("data-uri",actionContext.uri),router.dispatch(`${this.url}?id=${actionContext.id}`)}),binder.register("deleteSharedStimulus",function remove(actionContext){const self=this;let data={},mediaRelationsData={type:"media"};return"instance"===actionContext.context[0]?mediaRelationsData.sourceId=actionContext.id:mediaRelationsData.classId=actionContext.id,data.uri=uri.decode(actionContext.uri),data.classUri=uri.decode(actionContext.classUri),data.id=actionContext.id,data.signature=actionContext.signature,new Promise(function(resolve,reject){request({url:urlUtil.route("index","ResourceRelations","tao"),data:mediaRelationsData,method:"GET",noToken:!0}).then(function(responseRelated){let message;const haveItemReferences=responseRelated.data.relations,name=$("a.clicked",actionContext.tree).text().trim();"instance"===actionContext.context[0]?0===haveItemReferences.length?message=`${__("Are you sure you want to delete this")} <b>${name}</b>?`:message=relatedItemsPopupTpl({name,inUsageMessage:__("This \"%s\" is currently used in %d item(s)",name,haveItemReferences.length),confirmationMessage:__("Are you sure you want to delete this \"%s\"?",name),items:haveItemReferences}):"instance"!==actionContext.context[0]&&(0===haveItemReferences.length?message=`${__("Are you sure you want to delete this class and all of its content?")}`:0!==haveItemReferences.length&&(message=relatedItemsClassPopupTpl({name,number:haveItemReferences.length,items:haveItemReferences}))),callConfirmModal(actionContext,message,self.url,data,resolve,reject)}).catch(errorObject=>{let message;"class"===actionContext.context[0]&&999===errorObject.response.code&&(message=forbiddenClassActionTpl()),callAlertModal(actionContext,message,reject)})})})}),define("taoMediaManager/qtiCreator/helper/createDummyItemData",["taoQtiItem/qtiCreator/model/Item"],function(Item){"use strict";const _generateIdentifier=function _generateIdentifier(uri){const pos=uri.lastIndexOf("#");return uri.substr(pos+1)},creatorDummyItemData=function(sharedStimulusData){const newItem=new Item().id(_generateIdentifier(sharedStimulusData.id)).attr("title",sharedStimulusData.name);newItem.data("new",!0),newItem.data("dummy",!0);const itemData=Object.assign({},newItem);return delete itemData.bdy,delete itemData.rootElement,itemData.body=sharedStimulusData.body.body,itemData.qtiClass="assessmentItem",itemData.responseProcessing={attributes:{},qtiClass:"responseProcessing",responseRules:[],serial:`response_${sharedStimulusData.body.serial}`},itemData.response={},sharedStimulusData.body.attributes["xml:lang"]&&(itemData.attributes["xml:lang"]=sharedStimulusData.body.attributes["xml:lang"]),sharedStimulusData.body.attributes.class&&(itemData.attributes.class=sharedStimulusData.body.attributes.class),itemData};return creatorDummyItemData}),define("taoMediaManager/qtiCreator/helper/formatStyles",["jquery"],function($){"use strict";function handleStylesheetLoad(e){const path=e&&e.composedPath&&e.composedPath(),linkTag=path[0];if(linkTag){const stylesheetUrl=linkTag.href.split("&stylesheet="),rdf_styles=stylesheetUrl[0].split("%23").reverse()[0],assets=$(`[data-identifier='${rdf_styles}']`);if(assets.length)return void assets.each((h,asset)=>{const assetClassName=asset.children[0].className.match(/[\w-]*tao-[\w-]*/g)||asset.children[1].className.match(/[\w-]*tao-[\w-]*/g);assetClassName?_formatStyles(linkTag.sheet,assetClassName[0]):_hideStyles(linkTag.sheet)});const stylesheetSerial=linkTag.dataset.serial,passagesItem=$(`div[data-serial*='${stylesheetSerial}']`);if(passagesItem.length)return void passagesItem.each((h,passages)=>{const passageWrapper=$(passages).find(".qti-include > div"),passageItemClassName=passageWrapper[0]&&passageWrapper[0].className&&passageWrapper[0].className.match(/[\w-]*tao-[\w-]*/g);passageItemClassName&&_formatStyles(linkTag.sheet,passageItemClassName[0])});const passagesPreview=$(`[data-href*='${rdf_styles}']`);if(passagesPreview.length)return void passagesPreview.each((h,passages)=>{const passagePreviewClassName=passages.className.match(/[\w-]*tao-[\w-]*/g);passagePreviewClassName&&_formatStyles(linkTag.sheet,passagePreviewClassName[0])})}}function _hideStyles(linkTag){const{cssRules}=linkTag||{},CSSStyleSheet=linkTag||{};cssRules&&Object.values(cssRules).map((index,rule)=>{CSSStyleSheet.deleteRule(index)})}function _formatStyles(linkTag,className){const{cssRules}=linkTag||{},CSSStyleSheet=linkTag||{},classNameFormated=className&&className.length?`.${className}`:"",scopedCssRules=_scopeStyles(cssRules,classNameFormated,["body","html","div.qti-item"]);if(cssRules&&scopedCssRules){Object.values(cssRules).map((index,rule)=>{CSSStyleSheet.deleteRule(index)});const newRules=scopedCssRules.split("\n");Object.values(newRules).map(rule=>{CSSStyleSheet.insertRule(rule)})}}function _scopeStyles(cssRules,scopeSelector,toReplace,replacementSelector){if(!cssRules)return"";replacementSelector||(replacementSelector=scopeSelector);const scopedStyles=Object.values(cssRules).map(rule=>{if(!rule.selectorText)return"";const rulesInBrackets=rule.cssText.substr(rule.selectorText.length).trim(),selectors=rule.selectorText.split(/\s*,\s*/),scopedSelectors=[];for(let singleSelectorText of selectors){if(["html","body","div.qti-item"].includes(singleSelectorText))continue;let numRepeat=0;if(scopeSelector&&toReplace)for(let toReplaceSelector of toReplace)singleSelectorText.includes(toReplaceSelector)&&(0<numRepeat&&(replacementSelector=""),singleSelectorText=singleSelectorText.replace(new RegExp(toReplaceSelector,"ig"),replacementSelector),numRepeat++);const containsScopeSelector=singleSelectorText.includes(`${scopeSelector} `)||singleSelectorText.startsWith(scopeSelector)||singleSelectorText.endsWith(scopeSelector);scopeSelector&&!containsScopeSelector?scopedSelectors.push(`${scopeSelector} ${singleSelectorText}`):scopedSelectors.push(singleSelectorText)}return scopedSelectors.length?`${scopedSelectors.join(",")} ${rulesInBrackets}`:""});return scopedStyles.filter(str=>0<str.length).join("\n")};return{handleStylesheetLoad}}),define("taoMediaManager/qtiCreator/helper/sharedStimulusLoader",["jquery","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiCreator/model/qtiClasses","taoMediaManager/qtiCreator/helper/createDummyItemData","core/dataProvider/request","util/url","taoMediaManager/qtiCreator/helper/formatStyles"],function($,Loader,qtiClasses,creatorDummyItemData,request,urlUtil,formatStyles){"use strict";const qtiNamespace="http://www.imsglobal.org/xsd/imsqti_v2p2",qtiSchemaLocation={"http://www.imsglobal.org/xsd/imsqti_v2p2":"http://www.imsglobal.org/xsd/qti/qtiv2p2/imsqti_v2p2.xsd"},languagesUrl=urlUtil.route("index","Languages","tao"),creatorLoader={loadSharedStimulus(config,callback){if(config.id){const languagesList=request(languagesUrl),assetData=request(config.assetDataUrl,{id:config.id}),assetStyles=request(config.assetDataStyles,{uri:config.id});Promise.all([languagesList,assetData,assetStyles]).then(values=>{let loader,itemData;itemData=creatorDummyItemData(values[1]),values[2].children.length&&values[2].children.forEach((stylesheet,index)=>{if("tao-user-styles.css"!==stylesheet.name){const serial=`creator_${index}`,link=urlUtil.route("loadStylesheet","SharedStimulusStyling","taoMediaManager",{uri:config.id,stylesheet:stylesheet.name});itemData.stylesheets[serial]={qtiClass:"stylesheet",attributes:{href:link,media:"all",title:stylesheet.name,type:"text/css",onload:e=>formatStyles.handleStylesheetLoad(e)},serial,getComposingElements:()=>({})}}}),loader=new Loader().setClassesLocation(qtiClasses),loader.loadItemData(itemData,function(loadedItem){let namespaces;namespaces=loadedItem.getNamespaces(),namespaces[""]=qtiNamespace,loadedItem.setNamespaces(namespaces),loadedItem.setSchemaLocations(qtiSchemaLocation),languagesList&&loadedItem.data("languagesList",values[0]),callback(loadedItem,this.getLoadedClasses())})})}}};return creatorLoader}),define("taoMediaManager/qtiCreator/renderers/config",["lodash","taoQtiItem/qtiCommonRenderer/renderers/config","taoItems/assets/manager","taoItems/assets/strategies"],function(_,commonRenderConfig,assetManagerFactory,assetStrategies){"use strict";const assetManager=assetManagerFactory([assetStrategies.taomedia,assetStrategies.external,assetStrategies.base64,assetStrategies.baseUrl],{baseUrl:""}),locations=_.defaults({_container:"taoQtiItem/qtiCreator/renderers/Container",_tooltip:"taoQtiItem/qtiCreator/renderers/Tooltip",assessmentItem:"taoMediaManager/qtiCreator/renderers/Item",figure:"taoMediaManager/qtiCreator/renderers/Figure",img:"taoMediaManager/qtiCreator/renderers/Img",figcaption:"taoMediaManager/qtiCreator/renderers/Figcaption",math:"taoQtiItem/qtiCreator/renderers/Math",object:"taoMediaManager/qtiCreator/renderers/Object",table:"taoMediaManager/qtiCreator/renderers/Table"},commonRenderConfig.locations);return{name:"creatorRenderer",locations:locations,options:{assetManager:assetManager}}}),define("taoMediaManager/qtiCreator/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoMediaManager/qtiCreator/renderers/config"],function(Renderer,config){"use strict";return Renderer.build(config.locations,config.name,config.options)}),define("taoMediaManager/qtiCreator/helper/creatorRenderer",["jquery","lodash","taoMediaManager/qtiCreator/renderers/Renderer","taoItems/assets/manager","taoItems/assets/strategies","util/dom"],function($,_,Renderer,assetManagerFactory,assetStrategies,dom){"use strict";let creatorRenderer=null;const get=function(reset,config,areaBroker){let $bodyEltForm;return config=config||{},config.properties=config.properties||{},(!creatorRenderer||reset)&&($bodyEltForm=creatorRenderer?creatorRenderer.getOption("bodyElementOptionForm"):null,(reset||!$bodyEltForm||!$bodyEltForm.length||!dom.contains($bodyEltForm))&&(creatorRenderer=new Renderer({lang:"",uri:"",shuffleChoices:!1,itemOptionForm:$("#item-editor-item-property-bar #sidebar-right-passage-properties .panel"),bodyElementOptionForm:areaBroker.getElementPropertyPanelArea(),textOptionForm:$("#item-editor-text-property-bar #sidebar-right-text-block-properties .panel"),mediaManager:{appendContainer:"#mediaManager",browseUrl:config.properties.getFilesUrl,uploadUrl:config.properties.fileUploadUrl,deleteUrl:config.properties.fileDeleteUrl,downloadUrl:config.properties.fileDownloadUrl,fileExistsUrl:config.properties.fileExistsUrl,path:config.properties.path,root:config.properties.root},qtiCreatorContext:config.qtiCreatorContext,locations:config.properties.locations}),creatorRenderer.getAssetManager().setData({baseUrl:config.properties.baseUrl||""}),creatorRenderer.setAreaBroker(areaBroker),_.assign(creatorRenderer,{getCreatorContext:function getCreatorContext(){return this.getOption("qtiCreatorContext")}}))),creatorRenderer};return{get:get,setOption:function(name,value){return get().setOption(name,value)},setOptions:function(options){return get().setOptions(options)},load:function(qtiClasses,done){return get().load(function(){if(_.isFunction(done)){for(var _len=arguments.length,rest=Array(_len),_key=0;_key<_len;_key++)rest[_key]=arguments[_key];done.apply(this,rest)}},qtiClasses)}}}),define("tpl!taoMediaManager/qtiCreator/tpl/toolbars/cssToggler",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},helper;return"<li data-css-res=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"path")||(null==depth0?depth0:lookupProperty(depth0,"path")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"path",hash:{},data:data,loc:{start:{line:1,column:18},end:{line:1,column:26}}}):helper))+"\" data-order=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"order")||(null==depth0?depth0:lookupProperty(depth0,"order")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"order",hash:{},data:data,loc:{start:{line:1,column:40},end:{line:1,column:49}}}):helper))+"\">\n    <span class=\"icon-preview style-sheet-toggler\" title=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"title")||(null==depth0?depth0:lookupProperty(depth0,"title")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"title",hash:{},data:data,loc:{start:{line:2,column:58},end:{line:2,column:67}}}):helper))+"\"></span>\n    <span class=\"file-label truncate\" title=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"editLabelTxt")||(null==depth0?depth0:lookupProperty(depth0,"editLabelTxt")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"editLabelTxt",hash:{},data:data,loc:{start:{line:3,column:45},end:{line:3,column:61}}}):helper))+"\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:3,column:63},end:{line:3,column:72}}}):helper))+"</span>\n    <input type=\"text\" class=\"style-sheet-label-editor\" value=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:4,column:63},end:{line:4,column:72}}}):helper))+"\">\n    <span class=\"icon-bin\" title=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"deleteTxt")||(null==depth0?depth0:lookupProperty(depth0,"deleteTxt")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"deleteTxt",hash:{},data:data,loc:{start:{line:5,column:34},end:{line:5,column:47}}}):helper))+"\" data-role=\"css-delete\"></span>\n    <span class=\"icon-download\" title=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"downloadTxt")||(null==depth0?depth0:lookupProperty(depth0,"downloadTxt")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"downloadTxt",hash:{},data:data,loc:{start:{line:6,column:39},end:{line:6,column:54}}}):helper))+"\" data-role=\"css-download\"></span>\n</li>"},useData:!0})}),define("taoMediaManager/qtiCreator/editor/styleEditor/styleEditor",["jquery","lodash","i18n","util/urlParser","core/dataProvider/request","tpl!taoMediaManager/qtiCreator/tpl/toolbars/cssToggler","taoMediaManager/qtiCreator/helper/formatStyles","util/url","services/features","jquery.fileDownload"],function($,_,__,UrlParser,request,cssTpl,formatStyles,urlUtil,featuresService){"use strict";const styleSheetManagerVisibilityKey="taoMediaManager/creator/StyleSheetManager";let itemConfig,globalConfig;const _getUri=function(action){return globalConfig[`${action}CssUrl`]},_basename=function(path){return path.substring(path.lastIndexOf("/")+1)},mainClassSelector="mainClass",hashClassSelector="hashClass",taoHashClassPrefix="tao-";let hashClass="",mainClass="",style={},customStylesheet="",currentItem;const $styleElem=function(){let styleElem=$("#item-editor-user-styles");return styleElem.length?styleElem.empty():(styleElem=$("<style>",{id:"item-editor-user-styles"}),$("head").append(styleElem)),styleElem}(),common={title:__("Disable this stylesheet temporarily"),deleteTxt:__("Remove this stylesheet"),editLabelTxt:__("Edit stylesheet label"),downloadTxt:__("Download this stylesheet"),preparingMessageHtml:__("Preparing CSS, please wait\u2026"),failMessageHtml:__("There was a problem downloading your CSS, please try again."),isInValidLocalTxt:__("This stylesheet has not been found on the server. you may want to delete this reference")},erase=function(){return style={},$styleElem.text(""),!1},create=function(dontAppend){let css="",mSelector,mProp;return _.isEmpty(style)?erase():(_.forEach(style,(value1,key1)=>{css+=`${key1}{`,_.forEach(value1,(value2,key2)=>{if(_.isPlainObject(value2))for(mSelector in value2){for(mProp in css+=`${key2}{`,value2)css+=`${mProp}:${value2[mSelector]};`;css+="}"}else css+=`${key2}:${value2};`}),css+="}\n"}),dontAppend||$styleElem.text(css),css)},apply=function(selector,property,value){const itemBodyClass=document.querySelector(".qti-itemBody").classList;itemBodyClass.forEach(function(className){const searchClass=className.match(/(?<className>tao-\w+)?/);searchClass.groups.className&&(mainClass=searchClass.groups.className)}),selector=selector.replace(mainClassSelector,mainClass),selector=selector.replace(hashClassSelector,hashClass),style[selector]=style[selector]||{},value?(value=value.includes("!important")?value:`${value} !important`,style[selector][property]=value):(delete style[selector][property],0===_.size(style[selector])&&delete style[selector]),create(),$(document).trigger("stylechange.qti-creator")},verifyInit=function verifyInit(){if(!itemConfig)throw new Error("Missing itemConfig, did you call styleEditor.init()?");return!0},save=function save(){return verifyInit(),request(_getUri("save"),_.extend({},itemConfig,{cssJson:JSON.stringify(style),stylesheetUri:customStylesheet.attr("href")}),"POST")},deleteStylesheet=function(stylesheet){return verifyInit(),request(_getUri("save"),_.extend({},itemConfig,{cssJson:JSON.stringify({}),stylesheetUri:`css/${stylesheet}`}),"POST")},download=function(uri,name){verifyInit();let style=uri.match(/stylesheet=(?<groupName>.+\.css)?/);style||(style=uri.match(/\/(?<groupName>.+\.css)?/));let styleName="";style&&style.groups&&style.groups.groupName&&(styleName=decodeURIComponent(style.groups.groupName));const downloadUrl=urlUtil.build(_getUri("download"),{uri:globalConfig.id,stylesheet:styleName});name.length||(name=styleName),fetch(downloadUrl).then(resp=>resp.blob()).then(blob=>{const url=window.URL.createObjectURL(blob),a=document.createElement("a");a.style.display="none",a.href=url,a.download=name,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(url)}).catch(()=>common.failMessageHtml)},addStylesheet=function(stylesheet,itemConfig){function loadStylesheet(linkElement,stylesheetObject,isLocal,isValid){const serialNumber=+linkElement.data("serial").replace("creator_",""),isInvalidLocal=isLocal&&!isValid,tplData={path:stylesheetObject.attr("href"),label:stylesheetObject.attr("title")||fileName,title:common.title,deleteTxt:common.deleteTxt,downloadTxt:common.downloadTxt,editLabelTxt:isInvalidLocal?common.isInValidLocalTxt:common.editLabelTxt,order:serialNumber};listEntry=$(cssTpl(tplData)),listEntry.data("stylesheetObj",stylesheetObject);const listLinks=$("#style-sheet-toggler").find("[data-order]");let insertedInList=!1;if(listLinks.each(function(){const order=+$(this).data("order");!insertedInList&&order>serialNumber&&($(this).before(listEntry),insertedInList=!0)}),insertedInList||$("#style-sheet-toggler").append(listEntry),isInvalidLocal)return listEntry.addClass("not-available"),void listEntry.find("[data-role=\"css-download\"], .style-sheet-toggler").css("visibility","hidden");const cssLinks=$("link[data-serial^=\"creator\"]");let inserted=!1;cssLinks.each(function(){const serialCur=+$(this).data("serial").replace("creator_","");!inserted&&serialCur>serialNumber&&($(this).before(linkElement),inserted=!0)}),inserted||$styleElem.before(linkElement),setTimeout(function(){let isInit=!1;$(document).trigger("customcssloaded.styleeditor",[style]),$(window).trigger("resize"),currentItem.pendingStylesheetsInit&&(isInit=!0,currentItem.pendingStylesheetsInit--),$(document).trigger("stylechange.qti-creator",[{initializing:isInit}])},isLocal?500:3500)}let fileName,link,listEntry,parser;_.isString(stylesheet)&&(stylesheet=currentItem.createStyleSheet(stylesheet)),fileName=_basename(stylesheet.attr("href")),link=function(){const _link=$(stylesheet.render()),_href=itemConfig&&urlUtil.route("loadStylesheet","SharedStimulusStyling","taoMediaManager",{uri:itemConfig.id,stylesheet:fileName})||_link.attr("href"),_sep=-1<_href.indexOf("?")?"&":"?";return _link.attr("href",_href+_sep+new Date().getTime().toString()),_link[0].onload=e=>formatStyles.handleStylesheetLoad(e),_link}(),parser=new UrlParser(link.attr("href")),parser.checkCORS()?$.when($.ajax(link.attr("href"))).then(function(){loadStylesheet(link,stylesheet,!0,!0)},function(){loadStylesheet(link,stylesheet,!0,!1)}):loadStylesheet(link,stylesheet,!1)},addItemStylesheets=function(){let currentStylesheet;currentItem.pendingStylesheetsInit=_.size(currentItem.stylesheets),_.forEach(currentItem.stylesheets,value=>{currentStylesheet=value,"tao-user-styles.css"===_basename(currentStylesheet.attr("href"))?customStylesheet=currentStylesheet:addStylesheet(value)}),customStylesheet||(customStylesheet=currentItem.createStyleSheet("css/tao-user-styles.css"))},removeOrphanedStylesheets=function(){$("link[data-serial]").remove(),customStylesheet=null,erase()},getItem=function(){return currentItem},init=function(item,config){let href;globalConfig=config,currentItem=item,itemConfig={uri:config.id,lang:config.lang},removeOrphanedStylesheets(),addItemStylesheets(),href=customStylesheet.attr("href"),currentItem.data("responsive",!0),request(_getUri("load"),_.extend({},itemConfig,{stylesheetUri:href})).then(function(_style){style={},Object.keys(_style).forEach(key=>{if(!key.includes(mainClass))style[key]=_style[key];else{const selectorWithoutMainClass=key.replace(` .${mainClass}`,"").trim();style[selectorWithoutMainClass]=_style[key]}}),create(),$(document).trigger("customcssloaded.styleeditor",[style])}),featuresService.isVisible(styleSheetManagerVisibilityKey,!1)&&$("#sidebar-right-css-manager").show()},getStyle=function(){return style},getHashClass=function(){return hashClass},getMainClass=function(){return mainClass},setHashClass=function(cssClass){hashClass=cssClass},setMainClass=function(cssClass){mainClass=cssClass},generateHashClass=function(){return hashClass=`${taoHashClassPrefix}${Math.random().toString(36).substr(2,9)}`},generateMainClass=function(){return mainClass=`${taoHashClassPrefix}${Math.random().toString(36).substr(2,9)}`},replaceHashClass=function(selector){return hashClass&&selector.replace(hashClassSelector,hashClass)||selector},replaceMainClass=function(selector){return mainClass&&selector.replace(mainClassSelector,mainClass)||selector},clearCache=function(){removeOrphanedStylesheets(),$(document).off("customcssloaded.styleeditor")};return{apply:apply,save:save,deleteStylesheet:deleteStylesheet,download:download,erase:erase,init:init,create:create,getItem:getItem,getStyle:getStyle,addStylesheet:addStylesheet,getHashClass:getHashClass,setHashClass:setHashClass,generateHashClass:generateHashClass,replaceHashClass:replaceHashClass,getMainClass:getMainClass,setMainClass:setMainClass,generateMainClass:generateMainClass,replaceMainClass:replaceMainClass,clearCache:clearCache}}),define("taoMediaManager/qtiCreator/editor/styleEditor/styleSheetToggler",["jquery","taoMediaManager/qtiCreator/editor/styleEditor/styleEditor","i18n","lodash","util/url","taoQtiItem/qtiCreator/model/Stylesheet","tpl!taoQtiItem/qtiCreator/tpl/notifications/genericFeedbackPopup","ui/resourcemgr"],function($,styleEditor,__,_,urlUtil,Stylesheet,genericFeedbackPopup){"use strict";var $doc=$(document),styleSheetToggler=function(){var init=function(itemConfig){const _createInfoBox=function(data){var $messageBox=$(genericFeedbackPopup(data)),closeTrigger=$messageBox.find(".close-trigger");return $("body").append($messageBox),closeTrigger.on("click",function(){$messageBox.fadeOut(function(){$(this).remove()})}),setTimeout(function(){closeTrigger.trigger("click")},4e3),$messageBox},cssToggler=$("#style-sheet-toggler"),uploader=$("#stylesheet-uploader"),customCssToggler=$("[data-custom-css]"),getContext=function(trigger){trigger=$(trigger);const li=trigger.closest("li"),stylesheetObj=li.data("stylesheetObj")||new Stylesheet({href:li.data("css-res")}),input=li.find(".style-sheet-label-editor"),labelBox=input.prev(".file-label"),label=input.val();return{li:li,input:input,label:label,labelBox:labelBox,isCustomCss:!!li.data("custom-css"),isDisabled:li.find(".icon-preview").hasClass("disabled"),stylesheetObj:stylesheetObj,cssUri:stylesheetObj.attr("href")}};uploader.on("click",function(){uploader.resourcemgr({className:"stylesheets",appendContainer:"#mediaManager",pathParam:"stylesheet",path:"taomedia://mediamanager/",stylesheet:"taomedia://mediamanager/",root:"local",browseUrl:urlUtil.route("getStylesheets","SharedStimulusStyling","taoMediaManager"),uploadUrl:urlUtil.route("upload","SharedStimulusStyling","taoMediaManager"),deleteUrl:urlUtil.route("fileDeleteUrl","SharedStimulusStyling","taoMediaManager"),downloadUrl:urlUtil.route("loadStylesheet","SharedStimulusStyling","taoMediaManager"),params:{uri:itemConfig.id,lang:itemConfig.lang,filters:"text/css"},select:function(e,files){let styleListNames=["/tao-user-styles.css"],styleList=$("[data-css-res]");0<styleList.length&&styleList.each((i,style)=>{let styleGroup=style.dataset&&style.dataset.cssRes&&style.dataset.cssRes.match(/stylesheet=(?<groupName>.+\.css)?/);styleGroup||(styleGroup=style.dataset&&style.dataset.cssRes&&style.dataset.cssRes.match(/\/(?<groupName>.+\.css)?/)),styleGroup&&styleGroup.groups&&styleGroup.groups.groupName&&styleListNames.push(`/${decodeURIComponent(styleGroup.groups.groupName)}`)});const l=files.length;for(let i=0;i<l;i++)styleListNames.includes(files[i].file)?_createInfoBox({message:__("A stylesheet named <b>%s</b> is already attached to the passage.").replace("%s",files[i].file.substring(1)),type:"error"}):styleEditor.addStylesheet(files[i].file,itemConfig)}})});const deleteStylesheet=function(trigger){var context=getContext(trigger),attr=context.isDisabled?"disabled-href":"href",cssLinks=$("head link");let cssUri=context.cssUri;"/"===context.cssUri[0]&&(cssUri=context.cssUri.split("/").reverse()[0]);const deleteFile=context.stylesheetObj.attr("title")||cssUri;styleEditor.deleteStylesheet(deleteFile);const mediaManager=$("#mediaManager");mediaManager.children.length&&$("#mediaManager").children().trigger("filedelete.resourcemgr",[`/${context.label}`]),cssLinks.filter(`[${attr}*="${cssUri}"]`).remove(),context.li.remove(),$(".feedback-info").hide(),_createInfoBox({message:__("Style Sheet <b>%s</b> removed<br> Click <i>Add Style Sheet</i> to re-apply.").replace("%s",context.label),type:"info"})},downloadStylesheet=function(trigger){styleEditor.download(getContext(trigger).stylesheetObj.attributes.href,getContext(trigger).stylesheetObj.attributes.title)},saveLabel=function(trigger){var context=getContext(trigger),title=$.trim(context.input.val());return title?void(context.stylesheetObj.attr("title",title),context.input.hide(),context.labelBox.html(title).show()):(context.stylesheetObj.attr("title",""),!1)},handleAvailability=function(trigger){const context=getContext(trigger);if(context.isCustomCss||"tao-user-styles.css"===context.label)context.isDisabled?($("#item-editor-user-styles")[0].disabled=!1,customCssToggler.removeClass("not-available")):($("#item-editor-user-styles")[0].disabled=!0,customCssToggler.addClass("not-available")),$(trigger).toggleClass("disabled");else{const myLink=$(`link[data-serial=${context.stylesheetObj.serial}`);myLink.ready(()=>{context.isDisabled?(myLink[0].sheet.disabled=!1,context.li.removeClass("not-available")):(myLink[0].sheet.disabled=!0,context.li.addClass("not-available")),$(trigger).toggleClass("disabled")})}};cssToggler.on("click",function(e){var target=e.target,className=target.className;-1<className.indexOf("icon-preview")?handleAvailability(e.target):"not-available"!==target.parentElement.className&&(-1<className.indexOf("icon-bin")?deleteStylesheet(e.target):-1<className.indexOf("icon-download")&&downloadStylesheet(e.target))}),cssToggler.on("keydown","input",function(e){13===e.keyCode&&$(e.target).trigger("blur")}),cssToggler.on("blur","input",function(e){saveLabel(e.target)})};return{init:init}}();return styleSheetToggler}),define("taoMediaManager/qtiCreator/editor/styleEditor/fontSelector",["jquery","lodash","json!taoQtiItem/qtiCreator/editor/resources/font-stacks.json","taoMediaManager/qtiCreator/editor/styleEditor/styleEditor","i18n","select2"],function($,_,fontStacks,styleEditor,__){"use strict";const fontSelector=function($container){const selector="select#item-editor-font-selector",$selector=$container.find("select#item-editor-font-selector");let target=styleEditor.replaceHashClass($selector.data("target")),normalize=function(font){return font.replace(/"/g,"'").replace(/, /g,",")},clean=function(font){return font.substring(0,font.indexOf(",")).replace(/'/g,"").replace(/"/g,"")},resetButton=$selector.parent().find("[data-role=\"font-selector-reset\"]"),toLabel=function(font){return font=font.replace(/-/g," "),font.replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function($1){return $1.toUpperCase()})},format=function(state){const originalOption=state.element;return state.id?`<span style="font-size: 12px;${$(originalOption).attr("style")}">${state.text}</span>`:state.text},reset=function(){styleEditor.apply(target,"font-family"),$selector.select2("val","")},applyToStylesEditor=!0;$selector.empty(),$selector.append(`<option value="">${__("Default")}</option>`);const styles=styleEditor.getStyle()||{},selectedFontFamily=styles[target]&&styles[target]["font-family"]&&clean(styles[target]["font-family"]);_.forEach(fontStacks,(value,key)=>{const optGroup=$("<optgroup>",{label:toLabel(key)});_.forEach(value,font=>{const normalizeFont=normalize(font),option=$("<option>",{value:normalizeFont,text:clean(normalizeFont)}).css({fontFamily:normalizeFont});clean(normalizeFont)===selectedFontFamily&&option.attr("selected",!0),optGroup.append(option)}),$selector.append(optGroup)}),resetButton.off("click").on("click",reset),$selector.select2({formatResult:format,formatSelection:format,width:"resolve"}),$selector.off("change").on("change",function(){applyToStylesEditor?styleEditor.apply(target,"font-family",$(this).val()):applyToStylesEditor=!0}),$(document).on("customcssloaded.styleeditor",function(e,style){style[target]&&style[target]["font-family"]&&($selector.select2("val",style[target]["font-family"].replace(" !important","")),$(`${selector} option:selected`).first().attr("selected","selected")),applyToStylesEditor=!1,$selector.trigger("change")})};return fontSelector}),define("taoMediaManager/qtiCreator/editor/styleEditor/colorSelector",["jquery","lodash","i18n","taoMediaManager/qtiCreator/editor/styleEditor/styleEditor","taoQtiItem/qtiCreator/helper/popup","lib/farbtastic/farbtastic"],function($,_,__,styleEditor){"use strict";function rgbToHex(color){function toHexPair(inp){return`0${parseInt(inp,10).toString(16)}`.slice(-2)}if(!_.isString(color))return color;const rgbArr=/rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i.exec(color);return _.isArray(rgbArr)&&4===rgbArr.length?`#${toHexPair(rgbArr[1])}${toHexPair(rgbArr[2])}${toHexPair(rgbArr[3])}`:color}function additionalStylesToObject(){let additional=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";const styles={},additionalStyles=additional.split(";");return additionalStyles.forEach(element=>{const keyValue=element.split(":");styles[keyValue[0]]=keyValue[1]}),styles}const colorSelector=function($container){const colorPicker=$container.find(".item-editor-color-picker"),widget=colorPicker.find(".color-picker"),widgetBox=colorPicker.find(".color-picker-container"),titleElement=colorPicker.find(".color-picker-title"),input=colorPicker.find(".color-picker-input"),resetButtons=colorPicker.find(".reset-button"),colorTriggers=colorPicker.find(".color-trigger"),colorTriggerLabels=colorPicker.find("label"),$doc=$(document),additionalStyles={};let currentProperty="color",widgetObj;const setTitle=function(property,trigger){titleElement.text(trigger.parent().find("label").text())},setTriggerColor=function(){colorTriggers.each(function(){const $trigger=$(this);let target=styleEditor.replaceHashClass($trigger.data("target"));const style=styleEditor.getStyle()||{};let value;const targetOld=target.replace(" *","");style[target]&&style[target][$trigger.data("value")]?(value=style[target][$trigger.data("value")].replace(" !important",""),$trigger.css("background-color",value),$trigger.attr("title",rgbToHex(value))):style[targetOld]&&style[targetOld][$trigger.data("value")]?(value=style[targetOld][$trigger.data("value")].replace(" !important",""),$trigger.css("background-color",value),$trigger.attr("title",rgbToHex(value))):($trigger.css("background-color",""),$trigger.attr("title",__("No value set")))})},collectCommonAdditionalStyles=function(){colorTriggers.each(function(){const $trigger=$(this);let target=styleEditor.replaceHashClass($trigger.data("target"));const value=$trigger.data("value"),styles=additionalStylesToObject($trigger.data("additional"));Object.keys(styles).forEach(key=>{additionalStyles[key]?additionalStyles[key].push({target,value}):additionalStyles[key]=[{target,value}]})})};widgetObj=$.farbtastic(widget).linkTo(input),setTriggerColor(),collectCommonAdditionalStyles(),colorTriggers.add(colorTriggerLabels).off("click").on("click",function(){const $tmpTrigger=$(this),$trigger="label"===this.nodeName.toLowerCase()?$tmpTrigger.parent().find(".color-trigger"):$tmpTrigger;widget.prop("target",$trigger.data("target")),widget.prop("additional",$trigger.data("additional")||""),widgetBox.hide(),currentProperty=$trigger.data("value"),setTitle(currentProperty,$trigger),widgetObj.setColor(rgbToHex($trigger.css("background-color"))),widgetBox.show(),widget.on("colorchange.farbtastic",function(e,color){if(styleEditor.apply(widget.prop("target"),currentProperty,color),widget.prop("additional")){const styles=additionalStylesToObject(widget.prop("additional"));Object.keys(styles).forEach(key=>{styleEditor.apply(widget.prop("target"),key,styles[key])})}setTriggerColor()}),$doc.on("mouseup.colorselector",function(e){return $(e.target).hasClass("closer")?(widgetBox.hide(),widget.off("colorchange.farbtastic"),$doc.off("colorselector"),!1):widgetBox.is(e.target)||0!==widgetBox.has(e.target).length?void 0:(widgetBox.hide(),widget.off("colorchange.farbtastic"),$doc.off("colorselector"),!1)}),$doc.on("keyup.colorselector",function(e){if(27===e.keyCode)return widgetBox.hide(),widget.off("colorchange.farbtastic"),$doc.off("colorselector"),!1})}),resetButtons.off("click").on("click",function(){const $this=$(this),$colorTrigger=$this.parent().find(".color-trigger");let target=styleEditor.replaceHashClass($colorTrigger.data("target"));const value=$colorTrigger.data("value"),additional=$colorTrigger.data("additional");if(styleEditor.apply(target,value),additional){const styles=additionalStylesToObject(additional);Object.keys(styles).forEach(key=>{if(1===additionalStyles[key].length)styleEditor.apply(target,key);else{const style=styleEditor.getStyle()||{};let needToRemove=!0;additionalStyles[key].forEach(element=>{(target!==element.target||value!==element.value)&&style[target]&&style[element.target][element.value]&&(needToRemove=!1)}),needToRemove&&styleEditor.apply(target,key)}})}setTriggerColor()}),$doc.on("customcssloaded.styleeditor",setTriggerColor)};return colorSelector}),define("taoMediaManager/qtiCreator/editor/styleEditor/fontSizeChanger",["jquery","lodash","taoMediaManager/qtiCreator/editor/styleEditor/styleEditor"],function($,_,styleEditor){"use strict";const fontSizeChanger=function($container){const $fontSizeChanger=$container.find("#item-editor-font-size-changer");let itemSelector=styleEditor.replaceHashClass($fontSizeChanger.data("target"));itemSelector=styleEditor.replaceHashClass(itemSelector);const figcaptionSelector=`${itemSelector} figure figcaption`,$resetBtn=$fontSizeChanger.parents(".reset-group").find("[data-role=\"font-size-reset\"]"),$input=$container.find(".item-editor-font-size-text");let itemFontSize=parseInt($(itemSelector).css("font-size"),10)||14;const styles=styleEditor.getStyle()||{},itemSelectorOld=itemSelector.replace(" *","");styles[itemSelector]&&styles[itemSelector]["font-size"]?(itemFontSize=parseInt(styles[itemSelector]["font-size"],10),$input.val(itemFontSize)):styles[itemSelectorOld]&&styles[itemSelectorOld]["font-size"]?(itemFontSize=parseInt(styles[itemSelectorOld]["font-size"],10),$input.val(itemFontSize)):$input.val("");const resizeFont=function(){styleEditor.apply(itemSelector,"font-size",`${itemFontSize.toString()}px`);const figcaptionSize=14<itemFontSize?(itemFontSize-2).toString():Math.min(itemFontSize,12).toString();styleEditor.apply(figcaptionSelector,"font-size",`${figcaptionSize}px`)};$fontSizeChanger.find("button").off("click").on("click",function(e){if(e.preventDefault(),"reduce"===$(this).data("action")){if(10>=itemFontSize)return;itemFontSize--}else itemFontSize++;resizeFont(),$input.val(itemFontSize),$(this).parent().blur()}),$input.off("blur").on("blur",function(){this.value?(itemFontSize=parseInt(this.value,10),resizeFont()):(styleEditor.apply(itemSelector,"font-size"),styleEditor.apply(figcaptionSelector,"font-size"))}),$input.off("keydown").on("keydown",function(e){var c=e.keyCode;return 13===c&&$input.trigger("blur"),_.contains([8,37,39,46],c)||48<=c&&57>=c||96<=c&&105>=c}),$resetBtn.off("click").on("click",function(){styleEditor.apply(itemSelector,"font-size"),styleEditor.apply(figcaptionSelector,"font-size"),$input.val(""),itemFontSize=parseInt($(itemSelector).css("font-size"),10)}),$(document).on("customcssloaded.styleeditor",function(e,style){style[itemSelector]&&style[itemSelector]["font-size"]?(itemFontSize=parseInt(style[itemSelector]["font-size"],10),$input.val(itemFontSize)):style[itemSelectorOld]&&style[itemSelectorOld]["font-size"]?(itemFontSize=parseInt(style[itemSelectorOld]["font-size"],10),$input.val(itemFontSize)):$input.val("")})};return fontSizeChanger}),define("taoMediaManager/qtiCreator/editor/propertiesPanel",["jquery","taoQtiItem/qtiCreator/helper/panel","taoMediaManager/qtiCreator/editor/styleEditor/styleEditor","taoMediaManager/qtiCreator/editor/styleEditor/styleSheetToggler","taoMediaManager/qtiCreator/editor/styleEditor/fontSelector","taoMediaManager/qtiCreator/editor/styleEditor/colorSelector","taoMediaManager/qtiCreator/editor/styleEditor/fontSizeChanger"],function($,panel,styleEditor,styleSheetToggler,fontSelector,colorSelector,fontSizeChanger){"use strict";return function setUpInteractionPanel($container,widget,config){panel.initSidebarAccordion($container),panel.initFormVisibilityListener();const elementClass={elementClass:styleEditor.getMainClass()};config=Object.assign(config,elementClass),styleEditor.init(widget.element,config),styleSheetToggler.init(config);const $passageEditor=$("#item-editor-item-property-bar");fontSelector($passageEditor),colorSelector($passageEditor),fontSizeChanger($passageEditor)}}),define("taoMediaManager/qtiXmlRenderer/renderers/config",["taoItems/assets/manager"],function(assetManagerFactory){"use strict";const assetManager=assetManagerFactory([{name:"nomalize",handle:function normalizeStrategy(url){if(url)return url.toString().replace(/^\.?\//,"")}}]);return{name:"xmlRenderer",locations:{_container:"taoQtiItem/qtiXmlRenderer/renderers/Container",assessmentItem:"taoMediaManager/qtiXmlRenderer/renderers/Item",_tooltip:"taoQtiItem/qtiXmlRenderer/renderers/Tooltip",math:"taoQtiItem/qtiXmlRenderer/renderers/Math",figure:"taoQtiItem/qtiXmlRenderer/renderers/Figure",img:"taoQtiItem/qtiXmlRenderer/renderers/Img",figcaption:"taoQtiItem/qtiXmlRenderer/renderers/Figcaption",object:"taoQtiItem/qtiXmlRenderer/renderers/Object",table:"taoQtiItem/qtiXmlRenderer/renderers/Table"},options:{assetManager:assetManager}}}),define("taoMediaManager/qtiXmlRenderer/renderers/Renderer",["taoQtiItem/qtiRunner/core/Renderer","taoMediaManager/qtiXmlRenderer/renderers/config"],function(Renderer,config){"use strict";return Renderer.build(config.locations,config.name,config.options)}),define("taoMediaManager/qtiCreator/helper/xmlRenderer",["core/logger","taoMediaManager/qtiXmlRenderer/renderers/Renderer","taoQtiItem/qtiItem/core/Element"],function(loggerFactory,XmlRenderer,Element){"use strict";const logger=loggerFactory("taoMediaManager/qtiCreator/helper/xmlRenderer"),_xmlRenderer=new XmlRenderer().load(),_render=function(element){let xml="";try{element instanceof Element&&(xml=element.render(_xmlRenderer))}catch(e){logger.error(e)}return xml};return{render:_render,get:function(){return _xmlRenderer}}}),define("taoMediaManager/qtiCreator/editor/interactionsPanel",["lodash","i18n","taoQtiItem/qtiCreator/editor/interactionsToolbar","taoQtiItem/qtiCreator/helper/panel"],function(_,__,interactionsToolbar,panel){"use strict";return function setUpInteractionPanel($container){const tagTitles={inlineInteractions:__("Inline Interactions")},interactions={_container:{label:__("Text Block"),icon:"icon-font",description:__("Block contains the content (stimulus) of the item such as text or image. It is also required for Inline Interactions."),short:__("Block"),qtiClass:"_container",tags:[tagTitles.inlineInteractions,"text"],group:__("inline-interactions")}};interactionsToolbar.create($container,interactions),panel.initSidebarAccordion($container),panel.toggleInlineInteractionGroup()}}),define("taoMediaManager/qtiCreator/sharedStimulusCreator",["jquery","lodash","i18n","core/eventifier","taoQtiItem/qtiCreator/context/qtiCreatorContext","taoMediaManager/qtiCreator/helper/sharedStimulusLoader","taoMediaManager/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/helper/commonRenderer","taoMediaManager/qtiCreator/editor/propertiesPanel","taoQtiItem/qtiCreator/model/helper/event","taoMediaManager/qtiCreator/helper/xmlRenderer","taoQtiItem/qtiItem/helper/xmlNsHandler","core/request","util/url","taoMediaManager/qtiCreator/editor/interactionsPanel","taoMediaManager/qtiCreator/editor/styleEditor/styleEditor","taoQtiItem/qtiItem/core/Element"],function($,_,__,eventifier,qtiCreatorContextFactory,sharedStimulusLoader,creatorRenderer,commonRenderer,propertiesPanel,eventHelper,xmlRenderer,xmlNsHandler,request,urlUtil,interactionPanel,styleEditor,Element){"use strict";const loadSharedStimulus=function loadSharedStimulus(id,uri,assetDataUrl,assetDataStyles){return new Promise(function(resolve,reject){sharedStimulusLoader.loadSharedStimulus({id,uri,assetDataUrl,assetDataStyles},function(item){item||reject(new Error("Unable to load the Shared Stimulus")),item.data("uri",uri),resolve(item)})})},sharedStimulusCreatorFactory=function sharedStimulusCreatorFactory(config,areaBroker,pluginFactories){let sharedStimulusCreator;const qtiCreatorContext=qtiCreatorContextFactory(),plugins={},pluginRun=function pluginRun(method){const execStack=[];return _.forEach(plugins,function(plugin){_.isFunction(plugin[method])&&execStack.push(plugin[method]())}),Promise.all(execStack)};if(!_.isPlainObject(config))throw new TypeError("The shared stimulus creator configuration is required");if(!config.properties||_.isEmpty(config.properties.uri)||_.isEmpty(config.properties.baseUrl))throw new TypeError("The creator configuration must contains the required properties triples: uri, label and baseUrl");if(!areaBroker)throw new TypeError("Without an areaBroker there are no chance to see something you know");return sharedStimulusCreator=eventifier({init(){return _.forEach(pluginFactories,pluginFactory=>{const plugin=pluginFactory(this,areaBroker);plugins[plugin.getName()]=plugin}),$(document).off(".qti-widget"),this.on("save",silent=>{const item=this.getItem();item.attributes.class||(item.attributes.class=sharedStimulusCreator.mainClass);const xml=xmlNsHandler.restoreNs(xmlRenderer.render(item),item.getNamespaces());Promise.all([request({url:urlUtil.route("patch","SharedStimulus","taoMediaManager",{id:config.properties.id}),type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify({body:xml}),method:"PATCH",noToken:!0}),styleEditor.save()]).then(()=>{silent||this.trigger("success"),this.trigger("saved")}).catch(err=>{this.trigger("error",err)})}),this.on("exit",function(){$(".item-editor-item",areaBroker.getItemPanelArea()).empty(),this.destroy()}),loadSharedStimulus(config.properties.id,config.properties.uri,config.properties.assetDataUrl,config.properties.assetDataStyles).then(item=>_.isObject(item)?void(this.item=item):void this.trigger("error",new Error(`Unable to load the item ${config.properties.label}`))).then(()=>pluginRun("init")).then(()=>{this.trigger("init",this.item)}).then(()=>(qtiCreatorContext.on("error",err=>{this.trigger("error",err)}),qtiCreatorContext.init())).catch(err=>{this.trigger("error",err)}),this},render(){const self=this,item=this.getItem();return item&&_.isFunction(item.getUsedClasses)?(commonRenderer.setContext(areaBroker.getItemPanelArea()),commonRenderer.get(!0,config).setOption("baseUrl",config.properties.baseUrl),interactionPanel(areaBroker.getInteractionPanelArea()),$(document).on("ready.qti-widget",(e,elt)=>{"assessmentItem"===elt.element.qtiClass&&this.trigger("ready")}),$(document).on("afterStateInit.qti-widget",function(e,element,state){if(element.getRootElement().data("widget")){const $itemContainer=element.getRootElement().data("widget").$container;switch(state.name){case"active":Element.isA(element,"assessmentItem")||$itemContainer.removeClass("focus-border");break;case"sleep":$itemContainer.find(".widget-box.edit-active").length||($itemContainer.addClass("focus-border"),styleEditor.getMainClass(item.class))}}}),config.qtiCreatorContext=qtiCreatorContext,creatorRenderer.get(!0,config,areaBroker).setOptions(config.properties).load(function(){let widget;item.setRenderer(this),areaBroker.getItemPanelArea().append(item.render()),Promise.all(item.postRender(_.clone(config.properties))).then(function(){return areaBroker.getContainer().data("widget",item),widget=item.data("widget"),item.attributes.class?styleEditor.setMainClass(item.attributes.class):styleEditor.generateMainClass(),sharedStimulusCreator.mainClass=styleEditor.getMainClass(),widget.$container.find(".qti-itemBody").addClass(sharedStimulusCreator.mainClass),propertiesPanel(areaBroker.getPropertyPanelArea(),widget,config.properties),eventHelper.initElementToWidgetListeners(),pluginRun("render").then(function(){self.trigger("render")})}).catch(function(err){self.trigger("error",err)})},item.getUsedClasses()),this):this.trigger("error",new Error("We need an item to render."))},destroy(){return $(document).off(".qti-widget"),styleEditor.clearCache(),pluginRun("destroy").then(()=>qtiCreatorContext.destroy()).then(()=>{this.trigger("destroy")}).catch(err=>{this.trigger("error",err)}),this},getItem(){return this.item},getSharedStimulusId(){return config.properties.id},getConfig(){return config}}),sharedStimulusCreator};return sharedStimulusCreatorFactory}),define("tpl!taoMediaManager/qtiCreator/component/tpl/sharedStimulusAuthoring",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<div id=\"item-editor-scope\" data-content-target=\"wide\">\n\n    <nav class=\"action-bar plain content-action-bar horizontal-action-bar\">\n        <ul class=\"menu-left action-group plain item-editor-menu\"></ul>\n\n        <ul class=\"menu action-group plain item-editor-menu\"></ul>\n\n        <ul class=\"menu-right action-group plain item-editor-menu\">\n        </ul>\n    </nav>\n    <div class=\"wrapper clearfix content sidebar-popup-parent\" id=\"item-editor-wrapper\">\n\n        <!-- interaction panel -->\n        <div class=\"item-editor-sidebar-wrapper left-bar\">\n            <form class=\"item-editor-sidebar\" id=\"item-editor-interaction-bar\" autocomplete=\"off\"></form>\n        </div>\n\n        <!-- item panel -->\n        <main id=\"item-editor-panel\" class=\"clearfix\">\n\n            <div class=\"item-editor-bar\">\n                <h1 class=\"truncate\"></h1>\n                <div id=\"toolbar-top\"></div>\n            </div>\n\n            <div id=\"item-editor-scoll-container\">\n                <div id=\"item-editor-scroll-outer\">\n                    <div id=\"item-editor-scroll-inner\">\n                        <!-- item goes here -->\n                    </div>\n                </div>\n            </div>\n\n        </main>\n\n        <!-- properties panel -->\n        <div class=\"item-editor-sidebar-wrapper right-bar sidebar-popup-parent\">\n            <div class=\"item-editor-sidebar\" id=\"item-editor-item-widget-bar\">\n                <div class=\"item-editor-item-related sidebar-right-section-box\" id=\"item-editor-item-property-bar\">\n                    <section class=\"tool-group clearfix\" id=\"sidebar-right-css-manager\" style=\"display: none;\">\n\n                        <h2>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Style Sheet Manager",{name:"__",hash:{},data:data,loc:{start:{line:42,column:28},end:{line:42,column:56}}}))+"</h2>\n\n                        <div class=\"panel\">\n\n                            <ul class=\"none\" id=\"style-sheet-toggler\">\n                                <!-- TAO style sheet -->\n                            </ul>\n                            <button id=\"stylesheet-uploader\" class=\"btn-info small block\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Add Style Sheet",{name:"__",hash:{},data:data,loc:{start:{line:49,column:90},end:{line:49,column:114}}}))+"</button>\n                        </div>\n                    </section>\n                    <section class=\"tool-group clearfix\" id=\"sidebar-right-passage-properties\">\n                        <h2>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Passage Properties",{name:"__",hash:{},data:data,loc:{start:{line:53,column:28},end:{line:53,column:55}}}))+"</h2>\n                        <div class=\"panel\"></div>\n                    </section>\n                    <section class=\"tool-group clearfix\" id=\"sidebar-right-style-editor\">\n\n                        <h2>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Passage Style",{name:"__",hash:{},data:data,loc:{start:{line:58,column:28},end:{line:58,column:50}}}))+"</h2>\n\n                        <div class=\"panel color-picker-panel\">\n                            <div class=\"item-editor-color-picker sidebar-popup-container-box\">\n                                <div class=\"color-picker-container sidebar-popup\">\n                                    <div class=\"sidebar-popup-title\">\n                                        <h3 class=\"color-picker-title\"></h3>\n                                        <a class=\"closer\" href=\"#\" data-close=\"#color-picker-container\"></a>\n                                    </div>\n                                    <div class=\"sidebar-popup-content\">\n                                        <div class=\"color-picker\"></div>\n                                        <input class=\"color-picker-input\" type=\"text\" value=\"#000000\">\n                                    </div>\n                                </div>\n                                <div class=\"reset-group\">\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-bg\" class=\"truncate\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Background color",{name:"__",hash:{},data:data,loc:{start:{line:74,column:81},end:{line:74,column:106}}}))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"background-color\"\n                                            aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove custom background color",{name:"__",hash:{},data:data,loc:{start:{line:76,column:56},end:{line:76,column:95}}}))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-bg\" data-value=\"background-color\"\n                                            data-target=\"body div.qti-item\" data-additional=\"padding:20px\"></button>\n                                    </div>\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-color\" class=\"truncate\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Text color",{name:"__",hash:{},data:data,loc:{start:{line:81,column:84},end:{line:81,column:103}}}))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"color\"\n                                              aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove custom text color",{name:"__",hash:{},data:data,loc:{start:{line:83,column:58},end:{line:83,column:91}}}))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-color\" data-value=\"color\"\n                                              data-target=\"body div.qti-item\"></button>\n                                    </div>\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-color\" class=\"truncate\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Border color",{name:"__",hash:{},data:data,loc:{start:{line:88,column:84},end:{line:88,column:105}}}))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"color\"\n                                              aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove custom border color",{name:"__",hash:{},data:data,loc:{start:{line:90,column:58},end:{line:90,column:93}}}))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-color\" data-value=\"border-color\"\n                                              data-target=\"body div.qti-item\" data-additional=\"border-width:4px;border-style:solid;padding:20px\"></button>\n                                    </div>\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-color\" class=\"truncate\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Table headings",{name:"__",hash:{},data:data,loc:{start:{line:95,column:84},end:{line:95,column:107}}}))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"color\"\n                                              aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove custom background color",{name:"__",hash:{},data:data,loc:{start:{line:97,column:58},end:{line:97,column:97}}}))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-color\" data-value=\"background-color\"\n                                              data-target=\"body div.qti-item table th\"></button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <hr>\n                        <div class=\"panel\">\n\n                            <div>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Font family",{name:"__",hash:{},data:data,loc:{start:{line:107,column:33},end:{line:107,column:53}}}))+"</div>\n\n                            <div class=\"reset-group\">\n                                <select\n                                    data-target=\"body div.qti-item *\"\n                                    id=\"item-editor-font-selector\"\n                                    data-has-search=\"false\"\n                                    data-placeholder=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Default",{name:"__",hash:{},data:data,loc:{start:{line:114,column:54},end:{line:114,column:70}}}))+"\"\n                                    class=\"select2 has-icon\"\n                                    data-role=\"font-selector\"></select>\n                                <button class=\"icon-eraser reset-button\" data-role=\"font-selector-reset\"\n                                      aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove custom font family",{name:"__",hash:{},data:data,loc:{start:{line:118,column:50},end:{line:118,column:84}}}))+"\"></button>\n                            </div>\n\n                        </div>\n                        <div class=\"panel\">\n                            <div>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Font size",{name:"__",hash:{},data:data,loc:{start:{line:123,column:33},end:{line:123,column:51}}}))+"</div>\n                            <div class=\"reset-group\">\n                                <span id=\"item-editor-font-size-changer\" data-target=\"body div.qti-item *\">\n                                    <button data-action=\"reduce\" aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Reduce font size",{name:"__",hash:{},data:data,loc:{start:{line:126,column:77},end:{line:126,column:102}}}))+"\"\n                                        class=\"icon-smaller\"></button>\n                                    <button data-action=\"enlarge\" aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Enlarge font size",{name:"__",hash:{},data:data,loc:{start:{line:128,column:78},end:{line:128,column:104}}}))+"\"\n                                        class=\"icon-larger\"></button>\n                                </span>\n\n                                <span id=\"item-editor-font-size-manual-input\" class=\"item-editor-unit-input-box\">\n                                    <input type=\"text\" class=\"item-editor-font-size-text has-icon\"\n                                            placeholder=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"e.g. 13",{name:"__",hash:{},data:data,loc:{start:{line:134,column:57},end:{line:134,column:73}}}))+"\">\n                                    <span class=\"unit-indicator\">px</span>\n                                </span>\n                                <button class=\"icon-eraser reset-button\" data-role=\"font-size-reset\"\n                                      aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove custom font size",{name:"__",hash:{},data:data,loc:{start:{line:138,column:50},end:{line:138,column:82}}}))+"\"></button>\n                            </div>\n\n                        </div>\n\n                    </section>\n                </div>\n                <div class=\"item-editor-item-related sidebar-right-section-box\" id=\"item-editor-text-property-bar\">\n                    <section class=\"tool-group clearfix\" id=\"sidebar-right-style-editor\">\n\n                        <h2>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Text Block Style",{name:"__",hash:{},data:data,loc:{start:{line:148,column:28},end:{line:148,column:53}}}))+"</h2>\n\n                        <div class=\"panel color-picker-panel\">\n                            <div class=\"item-editor-color-picker sidebar-popup-container-box\">\n                                <div class=\"color-picker-container sidebar-popup\">\n                                    <div class=\"sidebar-popup-title\">\n                                        <h3 id=\"color-picker-title\"></h3>\n                                        <a class=\"closer\" href=\"#\" data-close=\"#color-picker-container\"></a>\n                                    </div>\n                                    <div class=\"sidebar-popup-content\">\n                                        <div class=\"color-picker\"></div>\n                                        <input class=\"color-picker-input\" type=\"text\" value=\"#000000\">\n                                    </div>\n                                </div>\n                                <div class=\"reset-group\">\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-bg\" class=\"truncate\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Background color",{name:"__",hash:{},data:data,loc:{start:{line:164,column:81},end:{line:164,column:106}}}))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"background-color\"\n                                              aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove custom background color",{name:"__",hash:{},data:data,loc:{start:{line:166,column:58},end:{line:166,column:97}}}))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-bg\" data-value=\"background-color\"\n                                              data-target=\"body div.qti-item .custom-text-box.hashClass\" data-additional=\"padding:20px;margin-bottom: 0;\"></button>\n                                    </div>\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-color\" class=\"truncate\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Text color",{name:"__",hash:{},data:data,loc:{start:{line:171,column:84},end:{line:171,column:103}}}))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"color\"\n                                              aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove custom text color",{name:"__",hash:{},data:data,loc:{start:{line:173,column:58},end:{line:173,column:91}}}))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-color\" data-value=\"color\"\n                                              data-target=\"body div.qti-item .custom-text-box.hashClass\"></button>\n                                    </div>\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-color\" class=\"truncate\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Border color",{name:"__",hash:{},data:data,loc:{start:{line:178,column:84},end:{line:178,column:105}}}))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"color\"\n                                              aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove custom border color",{name:"__",hash:{},data:data,loc:{start:{line:180,column:58},end:{line:180,column:93}}}))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-color\" data-value=\"border-color\"\n                                              data-target=\"body div.qti-item .custom-text-box.hashClass\" data-additional=\"border-width:4px;border-style:solid;padding:20px\"></button>\n                                    </div>\n                                    <div class=\"clearfix\">\n                                        <label for=\"initial-color\" class=\"truncate\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Table headings",{name:"__",hash:{},data:data,loc:{start:{line:185,column:84},end:{line:185,column:107}}}))+"</label>\n                                        <button class=\"icon-eraser reset-button\" data-value=\"color\"\n                                              aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove custom background color",{name:"__",hash:{},data:data,loc:{start:{line:187,column:58},end:{line:187,column:97}}}))+"\"></button>\n                                        <button class=\"color-trigger\" id=\"initial-color\" data-value=\"background-color\"\n                                              data-target=\"body div.qti-item .custom-text-box.hashClass table th\"></button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <hr>\n                        <div class=\"panel\">\n\n                            <div>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Font family",{name:"__",hash:{},data:data,loc:{start:{line:197,column:33},end:{line:197,column:53}}}))+"</div>\n\n                            <div class=\"reset-group\">\n                                <select\n                                    data-target=\"body div.qti-item .custom-text-box.hashClass *\"\n                                    id=\"item-editor-font-selector\"\n                                    data-has-search=\"false\"\n                                    data-placeholder=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Default",{name:"__",hash:{},data:data,loc:{start:{line:204,column:54},end:{line:204,column:70}}}))+"\"\n                                    class=\"select2 has-icon\"\n                                    data-role=\"font-selector\"></select>\n                                <button class=\"icon-eraser reset-button\" data-role=\"font-selector-reset\"\n                                      aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove custom font family",{name:"__",hash:{},data:data,loc:{start:{line:208,column:50},end:{line:208,column:84}}}))+"\"></button>\n                            </div>\n\n                        </div>\n                        <div class=\"panel\">\n                            <div>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Font size",{name:"__",hash:{},data:data,loc:{start:{line:213,column:33},end:{line:213,column:51}}}))+"</div>\n                            <div class=\"reset-group\">\n                                        <span id=\"item-editor-font-size-changer\" data-target=\"body div.qti-item .custom-text-box.hashClass *\">\n                                            <button data-action=\"reduce\" aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Reduce font size",{name:"__",hash:{},data:data,loc:{start:{line:216,column:85},end:{line:216,column:110}}}))+"\"\n                                               class=\"icon-smaller\"></button>\n                                            <button data-action=\"enlarge\" aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Enlarge font size",{name:"__",hash:{},data:data,loc:{start:{line:218,column:86},end:{line:218,column:112}}}))+"\"\n                                               class=\"icon-larger\"></button>\n                                        </span>\n\n                                <span id=\"item-editor-font-size-manual-input\" class=\"item-editor-unit-input-box\">\n                                            <input type=\"text\" class=\"item-editor-font-size-text has-icon\"\n                                                   placeholder=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"e.g. 13",{name:"__",hash:{},data:data,loc:{start:{line:224,column:64},end:{line:224,column:80}}}))+"\">\n                                                <span class=\"unit-indicator\">px</span>\n                                        </span>\n                                <button class=\"icon-eraser reset-button\" data-role=\"font-size-reset\"\n                                      aria-label=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove custom font size",{name:"__",hash:{},data:data,loc:{start:{line:228,column:50},end:{line:228,column:82}}}))+"\"></button>\n                            </div>\n\n                        </div>\n\n                    </section>\n                    <section class=\"tool-group clearfix\" id=\"sidebar-right-text-block-properties\">\n                        <h2>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Text Block Properties",{name:"__",hash:{},data:data,loc:{start:{line:235,column:28},end:{line:235,column:58}}}))+"</h2>\n\n                        <div class=\"panel\"></div>\n                    </section>\n                </div>\n                <div class=\"item-editor-body-element-related sidebar-right-section-box\" id=\"item-editor-body-element-property-bar\">\n                    <section class=\"tool-group clearfix\" id=\"sidebar-right-body-element-properties\">\n                        <h2><?= __('Element Properties') ?></h2>\n\n                        <div class=\"panel\"></div>\n                    </section>\n                </div>\n            </div>\n        </div>\n        <!-- /properties panel -->\n\n\n    </div>\n\n    <div id=\"mediaManager\"></div>\n    <div id=\"modal-container\"></div>\n</div>"},useData:!0})}),define("taoMediaManager/qtiCreator/component/sharedStimulusAuthoring",["lodash","ui/component","core/pluginLoader","taoMediaManager/qtiCreator/sharedStimulusCreator","taoQtiItem/qtiCreator/editor/areaBroker","tpl!taoMediaManager/qtiCreator/component/tpl/sharedStimulusAuthoring","context","css!taoQtiItemCss/qti-runner.css","css!taoQtiItemCss/themes/default.css","css!taoQtiItemCss/item-creator.css"],function(_,componentFactory,pluginLoaderFactory,sharedStimulusCreatorFactory,areaBrokerFactory,componentTpl,context){"use strict";function sharedStimulusAuthoringFactory(container){let config=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},areaBroker,sharedStimulusCreator;const plugins=Array.isArray(config.plugins)?config.plugins:[];config.plugins=[...defaultPlugins,...plugins];const pluginLoader=pluginLoaderFactory(),api={getAreaBroker(){return areaBroker}},sharedStimulusAuthoring=componentFactory(api).setTemplate(componentTpl).on("init",function(){_.forEach(this.getConfig().plugins,plugin=>{plugin&&plugin.module&&(plugin.exclude?pluginLoader.remove(plugin.module):pluginLoader.add(plugin))}),pluginLoader.load(!!context.bundle).then(()=>this.render(container)).catch(err=>this.trigger("error",err))}).on("render",function(){const $container=this.getElement();areaBroker=areaBrokerFactory($container,{menu:$container.find(".menu"),menuLeft:$container.find(".menu-left"),menuRight:$container.find(".menu-right"),contentCreatorPanel:$container.find("#item-editor-panel"),editorBar:$container.find("#item-editor-panel .item-editor-bar"),title:$container.find("#item-editor-panel .item-editor-bar h1"),toolbar:$container.find("#item-editor-panel .item-editor-bar #toolbar-top"),interactionPanel:$container.find("#item-editor-interaction-bar"),propertyPanel:$container.find("#item-editor-item-widget-bar"),itemPanel:$container.find("#item-editor-scroll-inner"),itemPropertyPanel:$container.find("#sidebar-right-item-properties"),itemStylePanel:$container.find("#item-style-editor-bar"),modalContainer:$container.find("#modal-container"),elementPropertyPanel:$container.find("#item-editor-body-element-property-bar .panel")}),sharedStimulusCreator=sharedStimulusCreatorFactory(this.getConfig(),areaBroker,pluginLoader.getPlugins()).spread(this,"error success ready").on("init",function(){this.render()}).on("destroy",function(){sharedStimulusCreator=null,sharedStimulusAuthoring.destroy()}).init()}).on("destroy",function(){sharedStimulusCreator&&sharedStimulusCreator.destroy(),sharedStimulusCreator=null,areaBroker=null});return _.defer(()=>sharedStimulusAuthoring.init(config)),sharedStimulusAuthoring}const defaultPlugins=[{module:"taoQtiItem/qtiCreator/plugins/content/title",bundle:"taoQtiItem/loader/taoQtiItem.min",category:"content"},{module:"taoMediaManager/qtiCreator/plugins/navigation/back",bundle:"taoMediaManager/loader/taoMediaManager.min",category:"menu"},{module:"taoMediaManager/qtiCreator/plugins/menu/save",bundle:"taoMediaManager/loader/taoMediaManager.min",category:"menu"},{module:"taoMediaManager/qtiCreator/plugins/menu/preview",bundle:"taoMediaManager/loader/taoMediaManager.min",category:"menu"},{module:"taoQtiItem/qtiCreator/plugins/content/changeTracker",bundle:"taoQtiItem/loader/taoQtiItem.min",category:"content"},{module:"taoMediaManager/qtiCreator/plugins/content/blockAdder",bundle:"taoMediaManager/loader/taoMediaManager.min",category:"content"}];return sharedStimulusAuthoringFactory}),define("taoMediaManager/controller/authoring",["i18n","lodash","jquery","uri","taoMediaManager/qtiCreator/component/sharedStimulusAuthoring","ui/feedback","util/url","core/dataProvider/request","core/logger"],function(__,_,$,uri,sharedStimulusAuthoringFactory,feedback,urlUtil,request,loggerFactory){"use strict";const logger=loggerFactory("taoMediaManager/authoring"),serviceController="SharedStimulus",serviceExtension="taoMediaManager",manageMediaController={start(){const $panel=$("#panel-authoring"),assetDataUrl=urlUtil.route("get",serviceController,serviceExtension),assetDataStyles=urlUtil.route("getStylesheets","SharedStimulusStyling",serviceExtension),assetId=uri.decode($panel.attr("data-id"));let previewEnabled=!1;request(assetDataUrl,{id:assetId}).then(response=>{response.permissions.includes("READ")&&(previewEnabled=!0)}).then(()=>{sharedStimulusAuthoringFactory($panel,{properties:{uri:$panel.attr("data-uri"),id:assetId,assetDataUrl,assetDataStyles,fileUploadUrl:urlUtil.route("upload","ItemContent","taoItems"),fileDeleteUrl:urlUtil.route("delete","ItemContent","taoItems"),fileDownloadUrl:urlUtil.route("download","ItemContent","taoItems"),fileExistsUrl:urlUtil.route("fileExists","ItemContent","taoItems"),getFilesUrl:urlUtil.route("files","ItemContent","taoItems"),baseUrl:urlUtil.route("getFile","MediaManager","taoMediaManager",{uri:""}),path:"taomedia://mediamanager/",root:"mediamanager",lang:"en-US",previewEnabled:previewEnabled,loadCssUrl:urlUtil.route("load","SharedStimulusStyling","taoMediaManager"),saveCssUrl:urlUtil.route("save","SharedStimulusStyling","taoMediaManager"),downloadCssUrl:urlUtil.route("loadStylesheet","SharedStimulusStyling","taoMediaManager")}}).on("success",()=>{feedback().success(__("Your passage is saved"))}).on("error",err=>{_.isUndefined(err.message)||feedback().error(err.message),logger.error(err)})})}};return manageMediaController}),define("taoMediaManager/previewer/component/qtiSharedStimulusItem",["context","taoQtiTestPreviewer/previewer/runner","css!taoQtiTestPreviewer/previewer/provider/item/css/item"],function(context,previewerFactory){"use strict";return function qtiItemPreviewerFactory(container){let config=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},template=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;const testRunnerConfig={testDefinition:"test-container",serviceCallId:"previewer",providers:{runner:{id:"qtiItemPreviewer",module:"taoQtiTestPreviewer/previewer/provider/item/item",bundle:"taoQtiTestPreviewer/loader/qtiPreviewer.min",category:"runner"},proxy:{id:"qtiSharedStimulusItemProxy",module:"taoMediaManager/previewer/proxy/qtiSharedStimulusItem",bundle:"taoMediaManager/loader/taoMediaManager.min",category:"proxy"},communicator:{id:"request",module:"core/communicator/request",bundle:"loader/vendor.min",category:"communicator"},plugins:config.plugins||[]},options:{view:config.view,readOnly:config.readOnly,fullPage:config.fullPage,plugins:config.pluginsOptions,hideActionBars:config.hideActionBars},proxyProvider:"qtiSharedStimulusItemProxy",loadFromBundle:!!context.bundle};return previewerFactory(container,testRunnerConfig,template).on("ready",function(runner){if(runner.on("renderitem",()=>{config.itemState&&runner.itemRunner.setState(config.itemState),this.trigger("preview-loaded")}),config.itemUri)return runner.loadItem(config.itemUri)})}}),define("taoMediaManager/controller/editInstance",["jquery","lodash","layout/actions/binder","ui/previewer","util/url","taoMediaManager/previewer/component/qtiSharedStimulusItem","core/logger","ui/feedback","layout/loading-bar"],function($,_,binder,previewer,urlUtil,qtiItemPreviewerFactory,loggerFactory,feedback,loadingBar){"use strict";const logger=loggerFactory("taoMediaManager/editInstance"),manageMediaController={start(){const $previewer=$(".previewer");let file={url:$previewer.data("url"),mime:$previewer.data("type")};const isPreviewEnabled=$previewer.data("enabled"),isPassage="application/qti+xml"===file.mime;isPreviewEnabled&&(isPassage?(loadingBar.start(),qtiItemPreviewerFactory($previewer,{itemUri:$("#edit-media").data("uri")}).on("error",function(err){_.isUndefined(err.message)||feedback().error(err.message),logger.error(err)}).on("preview-loaded",loadingBar.stop)):(file.containerClass="no-background",$previewer.previewer(file))),isPassage?$("#media-authoring").show():$("#media-authoring").hide(),$("#edit-media").off().on("click",function(){const action={binding:"load",url:urlUtil.route("editMedia","MediaImport","taoMediaManager")};binder.exec(action,{classUri:this.dataset.classuri,id:this.dataset.uri}||this._resourceContext)})}};return manageMediaController}),define("taoMediaManager/controller/routes",[],function(){"use strict";return{MediaManager:{deps:"controller/actions",actions:{editInstance:"controller/editInstance",authoring:"controller/authoring"}}}}),define("taoMediaManager/previewer/adapter/item/qtiSharedStimulusItem",["lodash","core/logger","taoMediaManager/previewer/component/qtiSharedStimulusItem","ui/feedback"],function(_,loggerFactory,qtiItemPreviewerFactory,feedback){"use strict";const logger=loggerFactory("taoMediaManager/previewer"),defaultPlugins=[{module:"taoQtiTestPreviewer/previewer/plugins/controls/close",bundle:"taoQtiTestPreviewer/loader/qtiPreviewer.min",category:"controls"},{module:"taoQtiTestPreviewer/previewer/plugins/tools/scale/scale",bundle:"taoQtiTestPreviewer/loader/qtiPreviewer.min",category:"tools"},{module:"taoQtiTest/runner/plugins/tools/itemThemeSwitcher/itemThemeSwitcher",bundle:"taoQtiTest/loader/testPlugins.min",category:"tools"}];return{name:"qtiSharedStimulusItem",init(sharedStimulusId){let config=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return config.itemUri=sharedStimulusId,config.plugins=Array.isArray(config.plugins)?[...defaultPlugins,...config.plugins]:defaultPlugins,qtiItemPreviewerFactory(window.document.body,config).on("error",function(err){_.isUndefined(err.message)||feedback().error(err.message),logger.error(err)})}}}),define("taoMediaManager/previewer/proxy/qtiSharedStimulusItem",["jquery","lodash","i18n","core/promiseQueue","core/dataProvider/request","util/url","taoMediaManager/qtiCreator/helper/createDummyItemData","taoMediaManager/qtiCreator/helper/formatStyles"],function($,_,__,promiseQueue,request,urlUtil,creatorDummyItemData,formatStyles){"use strict";const serviceController="SharedStimulus",serviceExtension="taoMediaManager";return{name:"qtiSharedStimulusItemProxy",install:function install(){this.queue=promiseQueue()},init:function init(){return Promise.resolve({})},destroy:function destroy(){return this.queue=null,Promise.resolve()},getItem:function getItem(identifier){return Promise.all([request(urlUtil.route("get",serviceController,serviceExtension),{id:identifier},"GET"),request(urlUtil.route("getStylesheets","SharedStimulusStyling",serviceExtension),{uri:identifier})]).then(_ref=>{let[data,styles]=_ref;const itemData=creatorDummyItemData(data);data.baseUrl=urlUtil.route("getFile","MediaManager","taoMediaManager",{uri:""}),data.content={type:"qti",data:itemData};const assetStyles=$("link[data-serial*=\"preview\"]");return assetStyles.length&&assetStyles.remove(),styles.children.forEach((stylesheet,index)=>{const serial=`preview_${index}`,link=urlUtil.route("loadStylesheet","SharedStimulusStyling","taoMediaManager",{uri:identifier,stylesheet:stylesheet.name});let cssFile=Object.values(document.styleSheets).find(sheet=>"string"==typeof sheet.href&&sheet.href===link);cssFile||(data.content.data.stylesheets[serial]={qtiClass:"stylesheet",attributes:{href:link,media:"all",title:"",type:"text/css",onload:e=>formatStyles.handleStylesheetLoad(e)},serial,getComposingElements:()=>({})})}),data})}}}),define("taoMediaManager/qtiCreator/widgets/helpers/content",["jquery","lodash","taoMediaManager/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/model/helper/container","taoQtiItem/qtiCreator/editor/gridEditor/content"],function($,_,creatorRenderer,containerHelper,gridContentHelper){"use strict";const contentHelper={createElements:function createElements(container,$container,data,callback){const $dummy=$("<div>").html(data);containerHelper.createElements(container,gridContentHelper.getContent($dummy),function(newElts){creatorRenderer.get().load(function(){_.each(newElts,function(serial){let $placeholder,$widget,widget;$placeholder=$container.find(`.widget-box[data-new][data-qti-class=${serial.qtiClass}]`),serial.setRenderer(this),serial.render($placeholder),serial.postRender(),widget=serial.data("widget"),$widget=widget.$original,$widget.trigger("contentChange.gridEdit"),_.isFunction(callback)&&callback(widget)}.bind(this))},this.getUsedClasses())})},changeInnerWidgetState:function _changeInnerWidgetState(outerWidget,state){const selector=[];_.forEach(["img","math","object","include"],function(qtiClass){selector.push(`[data-html-editable] .widget-${qtiClass}`)}),outerWidget.$container.find(selector.join(",")).each(function(){const innerWidget=$(this).data("widget");innerWidget&&innerWidget.changeState(state)})}};return contentHelper}),define("taoMediaManager/qtiCreator/widgets/states/Active",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoMediaManager/qtiCreator/widgets/helpers/content"],function($,stateFactory,contentHelper){"use strict";return stateFactory.create("active",function(){function checkIfWidgetShouldSleep(e){return container!==e.target&&!$.contains(container,e.target)&&$.contains(outerContainer,e.target)&&(!areaBroker||!areaBroker.getEditorBarArea||!$.contains(areaBroker.getEditorBarArea().get(0),e.target))&&(!$modalFeedbacksArea.length||!$.contains($modalFeedbacksArea[0],e.target))&&"restore"!==$(e.target).data("role")&&!$(e.target).closest(".widget-popup").length}const _widget=this.widget,container=_widget.$container[0],item=_widget.element.getRootElement(),areaBroker=_widget.getAreaBroker(),$modalFeedbacksArea=$("#modalFeedbacks"),outerContainer=document.querySelector("#item-editor-scroll-outer");areaBroker.getContentCreatorPanelArea().on(`mousedown.active.${_widget.serial}`,function(e){checkIfWidgetShouldSleep(e)&&_widget.changeState("sleep")}).on("beforesave.qti-creator.active",function(){_widget.changeState("sleep")}).on("styleedit.active",function(){_widget.changeState("sleep")}),$(document).on("open-preview.qti-item",function(){_widget.changeState("sleep")}),item&&item.data("widget")&&item.data("widget").$container.on("resizestart.gridEdit.active beforedragoverstart.gridEdit.active",function(){_widget.changeState("sleep")})},function(){const areaBroker=this.widget.getAreaBroker();contentHelper.changeInnerWidgetState(this.widget,"sleep"),this.widget.$container.off(".active"),areaBroker.getContentCreatorPanelArea().off(`.active.${this.widget.serial}`);const item=this.widget.element.getRootElement();item&&item.data("widget")&&item.data("widget").$container.off(".active")})}),define("taoMediaManager/qtiCreator/widgets/static/states/Active",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoMediaManager/qtiCreator/widgets/states/Active"],function($,stateFactory,Active){"use strict";return stateFactory.extend(Active,function(){var _widget=this.widget,$container=_widget.$container;_widget.beforeStateInit(function(e,element,state){var serial=element.getSerial(),composingElts;("active"===state.name&&serial!==_widget.serial||"choice"===state.name)&&("rubricBlock"===_widget.element.qtiClass?(composingElts=_widget.element.getComposingElements(),!composingElts[element.serial]&&_widget.changeState("sleep")):_widget.changeState("sleep"))},"otherActive"),$container.on("mouseenter.active",function(e){e.stopPropagation(),$container.parent().trigger("mouseleave.sleep")}).on("mouseleave.active",function(e){e.stopPropagation(),$container.parent().trigger("mouseenter.sleep")}).on("click.active",function(e){e.stopPropagation()})},function(){const _widget=this.widget,areaBroker=_widget.getAreaBroker();_widget.$container.off(".active"),areaBroker.getContentCreatorPanelArea().off(`.active.${_widget.serial}`),_widget.offEvents("otherActive")})}),define("taoMediaManager/qtiCreator/helper/ckConfigurator",["lodash","ui/ckeditor/ckConfigurator","mathJax"],function(_,ckConfigurator,mathJax){"use strict";const _defaults={qtiImage:!0,qtiMedia:!0,qtiInclude:!1,underline:!0,mathJax:!!mathJax,removePlugins:"taoqtiinclude",horizontalRule:!0,furiganaPlugin:!0},getConfig=function(editor){let toolbarType=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"qtiInline",options=2<arguments.length?arguments[2]:void 0;return ckConfigurator.getConfig(editor,toolbarType,_.defaults(options||{},_defaults))};return{getConfig:getConfig}}),define("taoMediaManager/qtiCreator/editor/ckEditor/htmlEditor",["lodash","i18n","jquery","ckeditor","core/promise","services/features","taoMediaManager/qtiCreator/helper/ckConfigurator","taoQtiItem/qtiItem/core/Element","taoMediaManager/qtiCreator/widgets/helpers/content","taoQtiItem/qtiCreator/widgets/helpers/deletingState","taoQtiItem/qtiCreator/editor/ckEditor/featureFlag","taoQtiItem/qtiCreator/helper/languages"],function(_,__,$,CKEditor,Promise,features,ckConfigurator,Element,contentHelper,deletingHelper,featureFlag,languages){"use strict";function _buildEditor($editable,$editableContainer,options){const widget=(options.data||{}).widget,areaBroker=widget&&widget.getAreaBroker&&widget.getAreaBroker(),$toolbarArea=areaBroker&&areaBroker.getToolbarArea&&areaBroker.getToolbarArea(),removePlugins=[];if(options=_.defaults(options,_defaults),!($editable instanceof $)||!$editable.length)throw new Error("invalid jquery element for $editable");if(!($editableContainer instanceof $)||!$editableContainer.length)throw new Error("invalid jquery element for $editableContainer");options.placeholder&&""!==options.placeholder&&($editable.is("input")?$editable.attr("placeholder",options.placeholder):$editable.attr("data-placeholder",options.placeholder)),options.removePlugins&&options.removePlugins.split("").forEach(removePluginName=>{removePlugins.push(removePluginName.trim())}),languagePluginEnabled||removePlugins.push("taolanguage");const ckConfig={dtdMode:"qti",autoParagraph:!1,removePlugins:removePlugins.join(","),enterMode:options.enterMode||CKEditor.ENTER_P,floatSpaceDockedOffsetY:10,language_list:options.language_list,sharedSpaces:{top:$toolbarArea&&$toolbarArea.attr("id")||"toolbar-top"},taoQtiItem:{insert:function(tempWidget){const $newContent=$(tempWidget).clone();if(options.data&&options.data.container&&options.data.widget){const $newImgPlaceholder=$editable.find("[data-new=\"true\"][data-qti-class=\"img\"]");!$newImgPlaceholder.length||$editable.closest(".qti-choice, .qti-flow-container").length||$newImgPlaceholder.closest(".qti-table caption").length||($newImgPlaceholder.attr("data-qti-class","figure"),$("<span>&nbsp;</span>").insertAfter($newImgPlaceholder)),contentHelper.createElements(options.data.container,$editable,_htmlEncode(this.getData()),function(createdWidget){const createdElement=createdWidget.element;_.isFunction(createdElement.initContainer)&&(createdElement.body($newContent.html()),createdWidget.rebuild(),createdWidget=createdElement.data("widget")),_activateInnerWidget(options.data.widget,createdWidget)});const editor=$editable.data("editor");editor.focusManager.blur(!0)}}},on:{instanceReady:function(e){let widgets={};const editor=e.editor;$editable.data("editor",editor),$editable.data("editor-options",options),editor.on("change",_.debounce(function markupChanged(){_detectWidgetDeletion($editable,widgets,editor),_.isFunction(options.change)&&options.change.call(editor,_htmlEncode(editor.getData()))},100,{leading:!0})),managePlaceholder($editable,editor),options.data&&options.data.container&&($editable.data("qti-container",options.data.container),widgets=_rebuildWidgets(options.data.container,$editable,{restoreState:!0}),options.shieldInnerContent&&_shieldInnerContent($editable,options.data.widget)),options.autofocus&&_focus(editor),$editable.trigger("editorready",[editor]),$(".qti-item").trigger("toolbarchange")},blur:function(){$toolbarArea&&$toolbarArea.hide()},focus:function(){$toolbarArea&&$toolbarArea.show(),_.isFunction(options.focus)&&options.focus.call(this,_htmlEncode(this.getData())),$editable.trigger("editorfocus"),$(".qti-item").trigger("toolbarchange")},configLoaded:function(e){let toolbarType=options.toolbarType||"";options.toolbar&&_.isArray(options.toolbar)?ckConfig.toolbar=options.toolbar:toolbarType=getTooltypeFromContainer($editableContainer),"undefined"!=typeof options.qtiMedia&&(ckConfig.qtiMedia=options.qtiMedia),"undefined"!=typeof options.qtiImage&&(ckConfig.qtiImage=options.qtiImage),"undefined"!=typeof options.qtiInclude&&(ckConfig.qtiInclude=options.qtiInclude),"undefined"!=typeof options.highlight&&(ckConfig.highlight=options.highlight),e.editor.config=ckConfigurator.getConfig(e.editor,toolbarType,ckConfig)},afterPaste:function(){}}};return CKEditor.inline($editable[0],ckConfig)}function managePlaceholder($editable,editor){$editable.is("input")||(togglePlaceholder($editable),editor.on("change",function(){togglePlaceholder($editable)}))}function togglePlaceholder($editable){const nonEmptyContent=["img","table","math","object","printedVariable",".tooltip-target"];""!==$editable.text().trim()||$editable.find(nonEmptyContent.join(",")).length?removePlaceholder($editable):$editable.addClass(placeholderClass)}function removePlaceholder($editable){$editable.removeClass(placeholderClass)}function getTooltypeFromContainer($editableContainer){let toolbarType="qtiFlow";return $editableContainer.hasClass("widget-blockInteraction")||$editableContainer.hasClass("widget-textBlock")||$editableContainer.hasClass("widget-rubricBlock")?toolbarType="qtiBlock":$editableContainer.hasClass("qti-prompt-container")||$editableContainer.hasClass("widget-hottext")?toolbarType="qtiInline":$editableContainer.hasClass("widget-table")&&!featureFlag.disableCellAlignment&&(toolbarType="qtiTable"),toolbarType}function _find($container,dataAttribute){let $collection;return $collection=$container.data(dataAttribute)?$container:$container.find(`[data-${dataAttribute}=true]`),$collection}function _rebuildWidgets(container,$container,options){const widgets={};return options=options||{},_.each(_.values(container.elements),function(elt){const widget=elt.data("widget"),currentState=widget.getCurrentState().name;widgets[elt.serial]=widget.rebuild({context:$container,ready:function(widgetInner){options.restoreState&&widgetInner.changeState(currentState)}})}),$container.trigger("widgetCreated",[widgets,container]),widgets}function _findWidgetContainer($container,serial){return $($container.selector).find(`.widget-box[data-serial=${serial}]`)}function _detectWidgetDeletion($container,widgets,editor){const deleted=[],container=$container.data("qti-container");if(_.each(widgets,function(w){if(!w.element.data("removed")){const $widget=_findWidgetContainer($container,w.serial);$widget.length||deleted.push(w)}}),deleted.length){const undoCmd=editor.getCommand("undo"),$messageBox=deletingHelper.createInfoBox(deleted);$messageBox.on("confirm.deleting",function(){_.each(deleted,function(w){w.element.remove(),w.destroy()}),editor.resetUndo()}).on("undo.deleting",function(){editor.undoManager.undo(),_rebuildWidgets(container,$container,{restoreState:!0}),_shieldInnerContent($container,container.data("widget"))}),undoCmd&&undoCmd.on("afterUndo",function(){$messageBox.find("a.undo").click()})}}function addShield($widget){const $shield=$("<button>",{class:"html-editable-shield"});return $widget.attr("contenteditable",!1),$widget.append($shield),$shield}function _shieldInnerContent($container,containerWidget){$container.find(".widget-box").each(function(){const $widget=$(this);addShield($widget).on("click",function(e){e.stopPropagation();const innerWidget=$widget.data("widget");_activateInnerWidget(containerWidget,innerWidget)})})}function _activateInnerWidget(containerWidget,innerWidget){let listenToWidgetCreation;const event=`widgetCreated.${innerWidget.serial}`;containerWidget&&containerWidget.element&&containerWidget.element.qtiClass?(listenToWidgetCreation=function(){containerWidget.$container.on(event,function(e,widgets){const targetWidget=widgets[innerWidget.serial];targetWidget&&(containerWidget.$container.off(event),_.delay(function(){Element.isA(targetWidget.element,"interaction")?targetWidget.changeState("question"):targetWidget.changeState("active")},100))})},Element.isA(containerWidget.element,"_container")&&!containerWidget.element.data("stateless")?(listenToWidgetCreation(),containerWidget.changeState("sleep")):Element.isA(containerWidget.element,"interaction")?(listenToWidgetCreation(),containerWidget.changeState("sleep")):Element.isA(containerWidget.element,"choice")?(listenToWidgetCreation(),containerWidget.changeState("question")):Element.isA(containerWidget.element,"table")?(listenToWidgetCreation(),containerWidget.changeState("sleep")):Element.isA(innerWidget.element,"choice")?innerWidget.changeState("choice"):innerWidget.changeState("active")):innerWidget.changeState("active")}function _htmlEncode(encodedStr){return encodedStr}function _focus(editor){if(editor.editable()&&editor.editable().$.parentNode){editor.focus();const range=editor.createRange();range.moveToElementEditablePosition(editor.editable(),!0),editor.getSelection().selectRanges([range])}}const _defaults={placeholder:__("some text ..."),shieldInnerContent:!0,passthroughInnerContent:!1,autofocus:!0},placeholderClass="cke-placeholder",languagePluginEnabled=features.isVisible("taoQtiItem/creator/editor/ckEditor/languagePlugin",!1);let editorFactory;return CKEditor.disableAutoInline=!0,editorFactory={hasEditor:function($container){let hasEditor=!1;return _find($container,"html-editable").each(function(){return hasEditor=!!$(this).data("editor"),hasEditor}),hasEditor},buildEditor:function($container,editorOptions){return languages.getList().then(languages.useCKEFormatting).then(languagesData=>{const buildTasks=[];return editorOptions.language_list=languagesData,_find($container,"html-editable-container").each(function(){const $editableContainer=$(this),$editable=$editableContainer.find("[data-html-editable]");buildTasks.push(new Promise(function(resolve){$editable.attr("contenteditable",!0),_buildEditor($editable,$editableContainer,editorOptions),$editable.on("editorready",resolve)}))}),Promise.all(buildTasks)})},destroyEditor:function($container){const destructTasks=[];return _find($container,"html-editable-container").each(function(){const $editableContainer=$(this),$editable=$editableContainer.find("[data-html-editable]");$editable.removeAttr("contenteditable"),$editable.data("editor")&&destructTasks.push(new Promise(function(resolve){const editor=$editable.data("editor"),options=$editable.data("editor-options");_.isFunction(options.change)&&options.change.call(editor,_htmlEncode(editor.getData())),removePlaceholder($editable),editor.on("destroy",function(){$editable.removeData("editor").removeData("editor-options"),$editable.data("qti-container")&&_rebuildWidgets($editable.data("qti-container"),$editable),$editable.trigger("editordestroyed"),resolve()}),editor.focusManager.blur(!0),editor.destroy()}))}),Promise.all(destructTasks)},getData:function($editable){const editor=$editable.data("editor");if(editor)return _htmlEncode(editor.getData());throw new Error("no editor attached to the DOM element")},setData:function($editable,data){const editor=$editable.data("editor");if(editor)_.isString(data)&&editor.setData(_.escape(data));else throw new Error("no editor attached to the DOM element")},focus:function($editable){_find($editable,"html-editable").each(function(){const editor=$(this).data("editor");editor&&_focus(editor)})}},editorFactory}),define("tpl!taoMediaManager/qtiCreator/tpl/forms/static/text",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},helper;return"<div class=\"panel\">\n    <label for=\"textBlockCssClass\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Text Block CSS Class",{name:"__",hash:{},data:data,loc:{start:{line:2,column:35},end:{line:2,column:64}}}))+"</label>\n    <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n    <div class=\"tooltip-content\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Set a CSS class name in order to customize the display style.",{name:"__",hash:{},data:data,loc:{start:{line:4,column:33},end:{line:4,column:103}}}))+"</div>\n    <input type=\"text\" name=\"textBlockCssClass\" value=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"textBlockCssClass")||(null==depth0?depth0:lookupProperty(depth0,"textBlockCssClass")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"textBlockCssClass",hash:{},data:data,loc:{start:{line:5,column:55},end:{line:5,column:76}}}):helper))+"\" />\n</div>"},useData:!0})}),define("taoMediaManager/qtiCreator/widgets/static/text/states/Active",["jquery","taoQtiItem/qtiCreator/widgets/states/factory","taoMediaManager/qtiCreator/widgets/static/states/Active","taoMediaManager/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoMediaManager/qtiCreator/tpl/forms/static/text","taoMediaManager/qtiCreator/editor/styleEditor/styleEditor","taoMediaManager/qtiCreator/editor/styleEditor/fontSelector","taoMediaManager/qtiCreator/editor/styleEditor/colorSelector","taoMediaManager/qtiCreator/editor/styleEditor/fontSizeChanger"],function($,stateFactory,Active,htmlEditor,content,formElement,formTpl,styleEditor,fontSelector,colorSelector,fontSizeChanger){"use strict";const wrapperCls="custom-text-box",TextActive=stateFactory.extend(Active,function(){this.buildStylesEditor(),this.buildEditor(),this.initForm()},function(){this.destroyEditor(),this.destroyStylesEditor(),this.widget.$form.empty()});return TextActive.prototype.buildEditor=function(){const widget=this.widget,$editableContainer=widget.$container,container=widget.element,changeCallback=content.getChangeCallback(container);$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{change:function(data){changeCallback.call(this,data),data||widget.$form.find("[name=\"textBlockCssClass\"]").val("")},blur:function(){widget.changeState("sleep")},data:{widget:widget,container:container}})},TextActive.prototype.buildStylesEditor=function(){const widget=this.widget,$editableContainer=widget.$container;let $block=$editableContainer.find(`.${wrapperCls}`);if(!$block.length){$block=widget.$container.find("[data-html-editable=\"true\"]").wrapInner("<div />").children();const hashClass=styleEditor.generateHashClass();$block.attr("class",`${wrapperCls} ${hashClass}`)}else{const blockCls=widget.$container.find(`.${wrapperCls}`).attr("class").split(" ");let hashClass=blockCls.find(className=>/^tao-*/.test(className));hashClass?styleEditor.setHashClass(hashClass):(hashClass=styleEditor.generateHashClass(),$block.addClass(hashClass))}const $textEditor=$("#item-editor-text-property-bar");fontSelector($textEditor),colorSelector($textEditor),fontSizeChanger($textEditor)},TextActive.prototype.destroyEditor=function(){htmlEditor.destroyEditor(this.widget.$container)},TextActive.prototype.destroyStylesEditor=function(){const hashClass=styleEditor.getHashClass(),$block=this.widget.$container.find(`.${wrapperCls}`),textBlockCssClass=($block.attr("class")||"").replace(wrapperCls,"").replace(hashClass,"").trim(),styles=styleEditor.getStyle(),regex=new RegExp(hashClass);textBlockCssClass||Object.keys(styles).find(selector=>regex.test(selector))||$block.children().unwrap()},TextActive.prototype.initForm=function(){const widget=this.widget,$form=widget.$form,blockCls=widget.$container.find(`.${wrapperCls}`).attr("class"),hashClass=styleEditor.getHashClass();$form.html(formTpl({textBlockCssClass:(blockCls||"").replace(wrapperCls,"").replace(hashClass,"").trim()})),formElement.initWidget($form),formElement.setChangeCallbacks($form,widget.element,{textBlockCssClass:function(element,value){let $block=widget.$container.find(`.${wrapperCls}`);value=value.trim(),value===wrapperCls&&(value=""),value&&(!$block.length&&($block=widget.$container.find("[data-html-editable=\"true\"]").wrapInner("<div />").children()),$block.attr("class",`${wrapperCls} ${value}`))}})},TextActive}),define("taoMediaManager/qtiCreator/widgets/static/text/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/text/states/Sleep","taoMediaManager/qtiCreator/widgets/static/text/states/Active"],function(factory,states){"use strict";return factory.createBundle(states,arguments)}),define("taoMediaManager/qtiCreator/widgets/static/text/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoMediaManager/qtiCreator/widgets/static/text/states/states","tpl!taoQtiItem/qtiCreator/tpl/toolbars/textBlock"],function($,Widget,states,toolbarTpl){"use strict";const TextWidget=Widget.clone();return TextWidget.initCreator=function(){Widget.initCreator.call(this),this.registerStates(states)},TextWidget.buildContainer=function(){const $wrap=$("<div>",{"data-serial":this.element.serial,"data-qti-class":"_container",class:"widget-box widget-block widget-textBlock"}).append($("<div>",{"data-html-editable":!0}));this.$original.wrapInner($wrap),this.$container=this.$original.children(".widget-box")},TextWidget.createToolbar=function(){const $tlb=$(toolbarTpl({serial:this.serial,state:"active"}));return this.$container.append($tlb),$tlb.find("[data-role=\"delete\"]").on("click.widget-box",e=>{e.stopPropagation(),this.changeState("deleting")}),this},TextWidget}),define("taoMediaManager/qtiCreator/editor/blockAdder/blockAdder",["jquery","lodash","tpl!taoQtiItem/qtiCreator/editor/blockAdder/tpl/addColumnRow","taoQtiItem/qtiItem/core/Element","taoMediaManager/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/model/helper/container","taoQtiItem/qtiCreator/editor/gridEditor/content","taoMediaManager/qtiCreator/widgets/static/text/Widget"],function($,_,adderTpl,Element,creatorRenderer,containerHelper,contentHelper,TextWidget){"use strict";function create(item,$editorPanel){function _getItemBody(){return $editorPanel.find(".qti-itemBody")}function _initInsertion($widget){const $wrap=$(_wrap);let $colRow=$widget.parent(".colrow");$editorPanel.trigger("beforesave.qti-creator.active"),$colRow.length||($widget.wrap(_wrap),$colRow=$widget.parent(".colrow")),$colRow.after($wrap);const $placeholder=$(_placeholder);$wrap.addClass("tmp").prepend($placeholder),_insertElement("_container",$placeholder)}function _endInsertion(){item.body(contentHelper.getContent(_getItemBody()))}function _done($wrap){$wrap.removeClass("tmp"),_endInsertion()}function _appendButton($widget){if(!$widget.children(".add-block-element").length&&!$widget.parent(".colrow.tmp").length){const $adder=$(adderTpl());$widget.append($adder),$adder.on("click",function(e){e.preventDefault(),e.stopPropagation();const $widgetParent=$(this).parents(".widget-box");_initInsertion($widgetParent)})}}$editorPanel.find(".widget-textBlock").each(function(){_appendButton($(this))}),$editorPanel.on("ready.qti-widget",function(e,_widget){const qtiElement=_widget.element;if(qtiElement.is("_container")){let $colRow=_widget.$container.parent(".colrow");$colRow.hasClass("tmp")&&_done($colRow),$colRow.length||_widget.$container.wrap(_wrap),_appendButton(_widget.$container)}})}function _insertElement(qtiClass,$placeholder){$placeholder.removeAttr("id"),$placeholder.addClass("widget-box"),$placeholder.attr({"data-new":!0,"data-qti-class":qtiClass});const $widget=$placeholder.parent().closest(".widget-box, .qti-item"),$editable=$placeholder.closest("[data-html-editable], .qti-itemBody"),widget=$widget.data("widget"),element=widget.element,container=Element.isA(element,"_container")?element:element.getBody();if(!element||!$editable.length)throw new Error("cannot create new element");containerHelper.createElements(container,contentHelper.getContent($editable),function(newElts){const creator=creatorRenderer.get();creator.load(function(){for(const serial in newElts){const elt=newElts[serial];let $colParent=$placeholder.parent(),$widgetElem,widgetElem;elt.setRenderer(this),$placeholder.replaceWith("<div class=\"text-block\"></div>");const $textBlock=$colParent.find(".text-block");$textBlock.html(elt.render()),widgetElem=TextWidget.build(elt,$textBlock,creator.getOption("textOptionForm"),{ready:function(){this.$container.parent(".text-block").length&&this.$container.unwrap(),this.changeState("active")}}),$widgetElem=widgetElem.$container,$widgetElem.trigger("contentChange.gridEdit"),$widgetElem.trigger("resize.gridEdit")}},this.getUsedClasses())})}const _wrap="<div class=\"colrow\"></div>",_placeholder="<div class=\"placeholder\">";return{create:create}}),define("taoMediaManager/qtiCreator/editor/containerEditor",["lodash","jquery","core/promise","taoQtiItem/qtiItem/core/Loader","taoQtiItem/qtiCreator/model/Container","taoQtiItem/qtiCreator/model/Item","taoQtiItem/qtiCreator/model/helper/event","taoQtiItem/qtiCreator/model/qtiClasses","taoQtiItem/qtiCreator/helper/commonRenderer","taoQtiItem/qtiCreator/helper/xmlRenderer","taoQtiItem/qtiItem/helper/simpleParser","taoMediaManager/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/editor/ckEditor/htmlEditor"],function(_,$,Promise,Loader,Container,Item,event,allQtiClasses,commonRenderer,xmlRenderer,simpleParser,creatorRenderer,content,htmlEditor){"use strict";function parser($container){const mathNs="m",data=simpleParser.parse($container.clone(),{ns:{math:"m"}});if(data.body)return data.body;throw new Error("invalid content for qti container")}function create($container,options){let html,htmls,data,loader;options=_.defaults(options||{},_defaults),options.markup&&(html=options.markup,options.markupSelector&&(htmls=extractHtmlFromMarkup(html,options.markupSelector),html=htmls[0]||""),$container.html(html)),data=parser($container),loader=new Loader().setClassesLocation(allQtiClasses),loader.loadRequiredClasses(data,function(){let qtiClasses=["img","object","math","include","printedVariable","_container","_tooltip"],item,containerEditors,renderer;const container=new Container;container.data("stateless",!0),$container.data("container",container),item=new Item().setElement(container),container.setRootElement(item),options.metadata&&_.each(options.metadata,function(value,name){item.data(name,value)}),options.related&&(containerEditors=options.related.data("container-editors")||[],containerEditors.push(container),options.related.data("container-editors",containerEditors)),this.loadContainer(container,data),renderer=creatorRenderer.get(options.resetRenderer,{},options.areaBroker),renderer.load(function(){container.setRenderer(this),$container.html(container.render()),container.postRender(),buildContainer($container),buildEditor($container,container,{placeholder:options.placeholder||"",toolbar:options.toolbar||"",qtiMedia:options.qtiMedia,highlight:options.highlight,removePlugins:options.removePlugins||"",areaBroker:options.areaBroker,autofocus:options.autofocus||!1}),$container.off(`.${_ns}`).on(event.getList(_ns+event.getNs()+event.getNsModel()).join(" "),_.throttle(function(){var editorContent=container.render(xmlRenderer.get());$container.trigger(`containerchange.${_ns}`,[editorContent]),_.isFunction(options.change)&&options.change(editorContent)},600)),$container.trigger("editorready.containereditor")},qtiClasses)})}function buildContainer($container){$container.wrapInner($("<div>",{class:"container-editor","data-html-editable":!0}))}function cleanup($container){const container=$container.data("container");return new Promise(function(resolve){container?($(document).off(`.${container.serial}`),commonRenderer.load(["img","object","math","include","_container","printedVariable","_tooltip"],function(){$container.html(container.render(this)),resolve()}),$container.removeData("container")):resolve()})}function createFakeWidget($editableContainer,container,options){var widget={$container:$editableContainer,element:container,changeState:_.noop,getAreaBroker:function getAreaBroker(){return options.areaBroker}};return container.data("widget",widget),widget}function buildEditor($editableContainer,container,options){$editableContainer.attr("data-html-editable-container",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,_.defaults(options||{},{shieldInnerContent:!1,passthroughInnerContent:!1,change:content.getChangeCallback(container),data:{widget:createFakeWidget($editableContainer,container,options),container:container}}))}function destroy($editableContainer){return htmlEditor.destroyEditor($editableContainer).then(function(){return $editableContainer.removeAttr("data-html-editable-container"),cleanup($editableContainer)})}function extractHtmlFromMarkup(markupStr,selector){const $found=$("<div>").html(markupStr).find(selector);let ret=[];return $found.each(function(){ret.push($(this).html())}),ret}const _ns="containereditor",_defaults={change:_.noop,markup:"",markupSelector:"",qtiMedia:!1};return event.initElementToWidgetListeners(),{create:create,destroy:destroy}}),define("taoMediaManager/qtiCreator/plugins/content/blockAdder",["i18n","core/plugin","taoMediaManager/qtiCreator/editor/blockAdder/blockAdder"],function(__,pluginFactory,blockAdder){"use strict";return pluginFactory({name:"blockAdder",init:function init(){},render:function render(){blockAdder.create(this.getHost().getItem(),this.getAreaBroker().getItemPanelArea())}})}),define("taoMediaManager/qtiCreator/plugins/menu/preview",["jquery","i18n","core/plugin","ui/hider","taoMediaManager/previewer/adapter/item/qtiSharedStimulusItem","tpl!taoQtiItem/qtiCreator/plugins/button"],function($,__,pluginFactory,hider,previewerFactory,buttonTpl){"use strict";return pluginFactory({name:"preview",init(){const SharedStimulusCreator=this.getHost();SharedStimulusCreator.on("preview",id=>{previewerFactory.init(id,{readOnly:!1,fullPage:!0})});const sharedStimulusConfig=SharedStimulusCreator.getConfig();sharedStimulusConfig.properties.previewEnabled&&(this.$element=$(buttonTpl({icon:"preview",title:__("Preview the item"),text:__("Preview"),cssClass:"preview-trigger",testId:"preview-the-asset"})).on("click",e=>{$(document).trigger("open-preview.qti-item"),e.preventDefault(),this.disable(),SharedStimulusCreator.trigger("preview",SharedStimulusCreator.getSharedStimulusId()),this.enable()}))},render(){const $container=this.getAreaBroker().getMenuArea();$container.append(this.$element)},destroy(){this.$element.remove()},enable(){this.$element.removeProp("disabled").removeClass("disabled")},disable(){this.$element.prop("disabled",!0).addClass("disabled")},show(){hider.show(this.$element)},hide(){hider.hide(this.$element)}})}),define("taoMediaManager/qtiCreator/plugins/menu/save",["jquery","i18n","core/plugin","ui/hider","tpl!taoQtiItem/qtiCreator/plugins/button"],function($,__,pluginFactory,hider,buttonTpl){"use strict";return pluginFactory({name:"save",init(){const sharedStimulusCreator=this.getHost();this.$element=$(buttonTpl({icon:"save",title:__("Save the asset"),text:__("Save"),cssClass:"save-trigger",testId:"save-the-asset"})).on("click",e=>{e.preventDefault(),this.disable(),$("#item-editor-panel").trigger("beforesave.qti-creator"),sharedStimulusCreator.trigger("save")}),this.hide(),this.disable(),sharedStimulusCreator.on("ready saved error",()=>{this.enable()})},render(){const $container=this.getAreaBroker().getMenuArea();$container.append(this.$element),this.show()},destroy(){this.$element.remove()},enable(){this.$element.removeProp("disabled").removeClass("disabled")},disable(){this.$element.prop("disabled",!0).addClass("disabled")},show(){hider.show(this.$element)},hide(){hider.hide(this.$element)}})}),define("taoMediaManager/qtiCreator/plugins/navigation/back",["jquery","i18n","core/plugin","ui/hider","tpl!taoQtiItem/qtiCreator/plugins/button"],function($,__,pluginFactory,hider,buttonTpl){"use strict";return pluginFactory({name:"back",init(){const sharedStimulusCreator=this.getHost();sharedStimulusCreator.on("exit",function(){window.history.back()}),this.$element=$(buttonTpl({icon:"left",title:__("Back to Manage Assets"),text:__("Manage Assets"),cssClass:"back-action",testId:"manage-assets"})).on("click",function backHandler(e){e.preventDefault(),sharedStimulusCreator.trigger("exit")}),this.hide()},render(){const $container=this.getAreaBroker().getMenuLeftArea();$container.append(this.$element),this.show()},destroy(){this.$element.remove()},enable(){this.$element.removeProp("disabled").removeClass("disabled")},disable(){this.$element.prop("disabled",!0).addClass("disabled")},show(){hider.show(this.$element)},hide(){hider.hide(this.$element)}})}),define("taoMediaManager/qtiCreator/renderers/Figcaption",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Figcaption"],function(_,Figcaption){"use strict";const CreatorFigcaption=_.clone(Figcaption);return CreatorFigcaption}),define("taoMediaManager/qtiCreator/widgets/static/figure/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/static/figure","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","ui/figure/FigureStateActive"],function(stateFactory,ActiveState,formTpl,formElement,inlineHelper,FigureStateActive){"use strict";return FigureStateActive({stateFactory,ActiveState,formTpl,formElement,inlineHelper})}),define("taoMediaManager/qtiCreator/widgets/static/figure/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/figure/states/Sleep","taoMediaManager/qtiCreator/widgets/static/figure/states/Active"],function(factory,states){return factory.createBundle(states,arguments)}),define("taoMediaManager/qtiCreator/widgets/static/figure/Widget",["jquery","lodash","taoQtiItem/qtiCreator/widgets/static/Widget","taoMediaManager/qtiCreator/widgets/static/figure/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline","ui/mediaEditor/plugins/mediaAlignment/helper"],function($,_,Widget,states,helper,toolbarTpl,inlineHelper,alignmentHelper){"use strict";const FigureWidget=Widget.clone();return FigureWidget.initCreator=function initCreator(options){const figure=this.element,img=_.find(figure.getBody().elements,elem=>elem.is("img"));this.registerStates(states),Widget.initCreator.call(this),inlineHelper.togglePlaceholder(this),alignmentHelper.initAlignment(this),inlineHelper.checkFileExists(this,img,"src",options.baseUrl),$("#item-editor-scope").on(`filedelete.resourcemgr.${this.element.serial}`,(e,src)=>{this.getAssetManager().resolve(img.attr("src"))===this.getAssetManager().resolve(src)&&(img.attr("src",""),inlineHelper.togglePlaceholder(this))})},FigureWidget.destroy=function destroy(){$("#item-editor-scope").off(`.${this.element.serial}`)},FigureWidget.getRequiredOptions=function(){return["baseUrl","uri","lang","mediaManager","assetManager"]},FigureWidget.buildContainer=function buildContainer(){this.element.attr("showFigure")?helper.buildBlockContainer(this):helper.buildInlineContainer(this);const img=_.find(this.element.getBody().elements,elem=>elem.is("img")),$img=this.$original.find("img");return $img.length&&(this.$container.css({width:img.attr("width")}),$img.attr("width","100%"),$img.removeAttr("style")),this},FigureWidget.createToolbar=function createToolbar(){return helper.createToolbar(this,toolbarTpl),this},FigureWidget}),define("taoMediaManager/qtiCreator/renderers/Figure",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Figure","taoMediaManager/qtiCreator/widgets/static/figure/Widget"],function(_,Figure,FigureWidget){"use strict";const CreatorFigure=_.clone(Figure);return CreatorFigure.render=function(figure,options){const imageElem=_.find(figure.getBody().elements,elem=>elem.is("img"));options=options||{},options.baseUrl=this.getOption("baseUrl"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),options.state=imageElem.metaData.widget&&imageElem.metaData.widget.getCurrentState().name,FigureWidget.build(figure,Figure.getContainer(figure),this.getOption("bodyElementOptionForm"),options)},CreatorFigure}),define("taoMediaManager/qtiCreator/widgets/static/img/states/Active",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/static/img","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","ui/image/ImgStateActive"],function(stateFactory,ActiveState,formTpl,formElement,inlineHelper,ImgStateActive){"use strict";return ImgStateActive(stateFactory,ActiveState,formTpl,formElement,inlineHelper)}),define("taoMediaManager/qtiCreator/widgets/static/img/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/img/states/Sleep","taoMediaManager/qtiCreator/widgets/static/img/states/Active"],function(factory,states){"use strict";return factory.createBundle(states,arguments)}),define("taoMediaManager/qtiCreator/widgets/static/img/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoMediaManager/qtiCreator/widgets/static/img/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline","ui/mediaEditor/plugins/mediaAlignment/helper"],function($,Widget,states,helper,toolbarTpl,inlineHelper,alignmentHelper){"use strict";const ImgWidget=Widget.clone();return ImgWidget.initCreator=function initCreator(options){const img=this.element;this.registerStates(states),Widget.initCreator.call(this),inlineHelper.togglePlaceholder(this),alignmentHelper.initAlignment(this),inlineHelper.checkFileExists(this,img,"src",options.baseUrl),$("#item-editor-scope").on(`filedelete.resourcemgr.${this.element.serial}`,(e,src)=>{this.getAssetManager().resolve(img.attr("src"))===this.getAssetManager().resolve(src)&&(img.attr("src",""),inlineHelper.togglePlaceholder(self))})},ImgWidget.destroy=function destroy(){$("#item-editor-scope").off(`.${this.element.serial}`)},ImgWidget.getRequiredOptions=function getRequiredOptions(){return["baseUrl","uri","lang","mediaManager","assetManager"]},ImgWidget.buildContainer=function buildContainer(){return helper.buildInlineContainer(this),this.$container.css({width:this.element.attr("width"),height:this.element.attr("height")}),this.$original[0]&&(this.$original[0].setAttribute("width","100%"),this.$original[0].removeAttribute("height")),this},ImgWidget.createToolbar=function createToolbar(){return helper.createToolbar(this,toolbarTpl),this},ImgWidget}),define("taoMediaManager/qtiCreator/renderers/Img",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Img","taoMediaManager/qtiCreator/widgets/static/img/Widget","taoQtiItem/qtiCreator/widgets/static/figure/Widget","taoQtiItem/qtiCreator/model/Figure","taoQtiItem/qtiCreator/helper/findParentElement"],function(_,Renderer,Widget,FigureWidget,FigureModel,findParentElement){"use strict";const CreatorImg=_.clone(Renderer);return CreatorImg.render=function render(img,options){const $container=Renderer.getContainer(img);if($container.parent("figure").length||$container.parent("span").length&&$container.parent("span").data("figure"))return!$container.parent("figure").length&&$container.siblings("figcaption").length&&$container.siblings("figcaption").remove(),CreatorImg;if(options=options||{},options.baseUrl=this.getOption("baseUrl"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),!$container.closest(".qti-choice, .qti-flow-container").length&&!$container.closest(".qti-table caption").length){const parent=findParentElement(img.rootElement,img.serial);parent.removeElement(img);const figure=new FigureModel;parent.setElement(figure);const figureRenderer=parent.getRenderer();figureRenderer&&(figure.setRenderer(figureRenderer),figureRenderer.load(()=>{},["figure"])),figure.setElement(img);const $wrap=$container.wrap(`<span data-serial="${figure.serial}">`).parent();FigureWidget.build(figure,$wrap,this.getOption("bodyElementOptionForm"),options)}else Widget.build(img,Renderer.getContainer(img),this.getOption("bodyElementOptionForm"),options)},CreatorImg}),define("tpl!taoMediaManager/qtiCreator/tpl/forms/item",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data,blockParams,depths){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return"    <div class=\"panel\">\n        <label for=\"xml:lang\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Language",{name:"__",hash:{},data:data,loc:{start:{line:4,column:12},end:{line:4,column:29}}}))+"\n        </label>\n        <span class=\"icon-help tooltipstered\" data-tooltip=\"~ .tooltip-content:first\" data-tooltip-theme=\"info\"></span>\n        <span class=\"tooltip-content\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Define item language.",{name:"__",hash:{},data:data,loc:{start:{line:8,column:12},end:{line:8,column:42}}}))+"\n        </span>\n        <select name=\"xml:lang\" class=\"select2\" data-has-search=\"false\">\n"+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"languagesList"),{name:"each",hash:{},fn:container.program(2,data,0,blockParams,depths),inverse:container.noop,data:data,loc:{start:{line:11,column:12},end:{line:13,column:21}}}))?"":stack1)+"        </select>\n    </div>\n"},2:function(container,depth0,helpers,partials,data,blockParams,depths){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1,helper;return"                <option value=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"key")||data&&lookupProperty(data,"key"))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"key",hash:{},data:data,loc:{start:{line:12,column:31},end:{line:12,column:39}}}):helper))+"\""+(null==(stack1=(lookupProperty(helpers,"equal")||depth0&&lookupProperty(depth0,"equal")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,data&&lookupProperty(data,"key"),null==depths[1]?depths[1]:lookupProperty(depths[1],"xml:lang"),{name:"equal",hash:{},fn:container.program(3,data,0,blockParams,depths),inverse:container.noop,data:data,loc:{start:{line:12,column:40},end:{line:12,column:97}}}))?"":stack1)+">"+container.escapeExpression(container.lambda(depth0,depth0))+"</option>\n"},3:function(container,depth0,helpers,partials,data){return" selected=\"selected\""},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data,blockParams,depths){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"languagesList"),{name:"if",hash:{},fn:container.program(1,data,0,blockParams,depths),inverse:container.noop,data:data,loc:{start:{line:1,column:0},end:{line:16,column:7}}}))?"":stack1},useData:!0,useDepths:!0})}),define("taoMediaManager/qtiCreator/widgets/item/states/Active",["lodash","taoQtiItem/qtiCreator/widgets/states/factory","taoMediaManager/qtiCreator/widgets/states/Active","tpl!taoMediaManager/qtiCreator/tpl/forms/item","taoQtiItem/qtiCreator/widgets/helpers/formElement"],function(_,stateFactory,Active,formTpl,formElement){"use strict";const ItemStateActive=stateFactory.create(Active,function enterActiveState(){const _widget=this.widget,item=_widget.element,$form=_widget.$form;$form.html(formTpl({"xml:lang":item.attr("xml:lang"),languagesList:item.data("languagesList")})),formElement.initWidget($form),formElement.setChangeCallbacks($form,item,{"xml:lang":formElement.getAttributeChangeCallback()})},_.noop);return ItemStateActive}),define("taoMediaManager/qtiCreator/widgets/item/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoMediaManager/qtiCreator/widgets/item/states/Active"],function(factory){"use strict";return factory.createBundle(arguments)}),define("taoMediaManager/qtiCreator/widgets/item/Widget",["lodash","i18n","jquery","core/promise","util/url","taoQtiItem/qtiCreator/widgets/Widget","taoMediaManager/qtiCreator/widgets/item/states/states","taoQtiItem/qtiItem/core/Element","taoMediaManager/qtiCreator/helper/creatorRenderer","taoQtiItem/qtiCreator/model/helper/container","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/helper/xmlRenderer","taoQtiItem/qtiCreator/helper/devTools","taoMediaManager/qtiCreator/widgets/static/text/Widget","taoQtiItem/qtiItem/helper/xmlNsHandler","taoQtiItem/qtiCreator/editor/jquery.gridEditor"],function(_,__,$,Promise,urlUtil,Widget,states,Element,creatorRenderer,containerHelper,contentHelper,xmlRenderer,devTools,TextWidget,xmlNsHandler){"use strict";function hasUnsupportedInteraction(xml){const $qti=$(xml);return 0<$qti.find("div.qti-interaction.qti-customInteraction[data-serial]").length}const ItemWidget=Widget.clone();ItemWidget.initCreator=function(config){const self=this;if(this.registerStates(states),Widget.initCreator.call(this),!config||!config.uri)throw new Error("missing required config parameter uri in item widget initialization");return this.saveItemUrl=config.saveItemUrl,this.renderer=config.renderer,this.itemUri=config.uri,new Promise(function(resolve){self.initTextWidgets(function(){this.initGridEditor(),this.debug({state:!1,xml:!1}),resolve()})})},ItemWidget.buildContainer=function(){this.$container=this.$original},ItemWidget.initUiComponents=function(){const element=this.element,$saveBtn=$("#save-trigger");this.on("metaChange",function(data){if(data.element.getSerial()===element.getSerial()&&"invalid"===data.key){const invalid=element.data("invalid");_.size(invalid)?$saveBtn.addClass("disabled"):$saveBtn.removeClass("disabled")}},!0)},ItemWidget.initGridEditor=function(){const self=this,item=this.element,$itemBody=this.$container.find(".qti-itemBody"),$itemEditorPanel=$("#item-editor-panel");$itemBody.gridEditor(),$itemBody.gridEditor("resizable"),$itemBody.gridEditor("addInsertables",$(".tool-list > [data-qti-class]:not(.disabled)"),{helper:function(){return $(this).find(".icon").clone().addClass("dragging")}}),$itemBody.on("beforedragoverstart.gridEdit",function(){$itemEditorPanel.addClass("dragging"),$itemBody.removeClass("hoverable").addClass("inserting")}).on("dragoverstop.gridEdit",function(){$itemEditorPanel.removeClass("dragging"),$itemBody.addClass("hoverable").removeClass("inserting")}).on("dropped.gridEdit.insertable",function(e,qtiClass,$placeholder){$placeholder.removeAttr("id"),"rubricBlock"===qtiClass&&($placeholder=$placeholder.parent(".col-12").parent(".grid-row")),$placeholder.addClass("widget-box"),$placeholder.attr({"data-new":!0,"data-qti-class":qtiClass});const $widget=$placeholder.parent().closest(".widget-box, .qti-item"),$editable=$placeholder.closest("[data-html-editable], .qti-itemBody"),widget=$widget.data("widget"),element=widget.element,container=Element.isA(element,"_container")?element:element.getBody();if(!element||!$editable.length)throw new Error("cannot create new element");containerHelper.createElements(container,contentHelper.getContent($editable),function(newElts){creatorRenderer.get().load(function(){_.forEach(newElts,elt=>{let $colParent=$placeholder.parent(),$eltWidget,eltwWdget;elt.setRenderer(this),Element.isA(elt,"_container")?($colParent.empty(),$colParent.html(elt.render()),eltwWdget=self.initTextWidget(elt,$colParent),$eltWidget=eltwWdget.$container):(elt.render($placeholder),elt.postRender(),eltwWdget=elt.data("widget"),$eltWidget=Element.isA(elt,"blockInteraction")?eltwWdget.$container:eltwWdget.$original),$eltWidget.trigger("contentChange.gridEdit"),$eltWidget.trigger("resize.gridEdit"),Element.isA(elt,"interaction")?eltwWdget.changeState("question"):eltwWdget.changeState("active")})},this.getUsedClasses())})}).on("resizestop.gridEdit",function(){item.body($itemBody.gridEditor("getContent"))})};const _detachElements=function(container,elements){const containerElements={};return _.each(elements,function(elementSerial){containerElements[elementSerial]=container.elements[elementSerial],delete container.elements[elementSerial]}),containerElements};return ItemWidget.initTextWidgets=function(callback){let self=this,item=this.element,$originalContainer=this.$container,i=1,subContainers=[];callback=callback||_.noop,$originalContainer.find(".qti-itemBody > .grid-row").each(function(){const $row=$(this);$row.hasClass("widget-box")||$row.children().each(function(){let $col=$(this),isTextBlock=!1;$col.contents().each(function(){if(3===this.nodeType&&this.nodeValue&&this.nodeValue.trim())return isTextBlock=!0,!1});const $widget=$col.children();(1<$widget.length||!$widget.hasClass("widget-blockInteraction"))&&($widget.hasClass("colrow")?$widget.each(function(){const $subElement=$(this),$subWidget=$subElement.children();(1<$subWidget.length||!$subWidget.hasClass("widget-blockInteraction"))&&($subElement.attr("data-text-block-id",`text-block-${i}`),i++)}):isTextBlock=!0),isTextBlock&&($col.attr("data-text-block-id",`text-block-${i}`),i++)})});const $clonedContainer=$originalContainer.clone();$clonedContainer.find(".qti-itemBody > .grid-row [data-text-block-id]").each(function(){const $originalTextBlock=$(this),textBlockId=$originalTextBlock.data("text-block-id"),$subContainer=$originalTextBlock.clone(),subContainerElements=contentHelper.serializeElements($subContainer),subContainerBody=$subContainer.html();$originalTextBlock.removeAttr("data-text-block-id").html("{{_container:new}}"),subContainers.push({body:subContainerBody,elements:subContainerElements,$original:$originalContainer.find(`[data-text-block-id="${textBlockId}"]`).removeAttr("data-text-block-id")})}),contentHelper.serializeElements($clonedContainer);const serializedItemBody=$clonedContainer.find(".qti-itemBody").html(),itemBody=item.getBody();subContainers.length?containerHelper.createElements(itemBody,serializedItemBody,function(newElts){if(_.size(newElts)!==subContainers.length)throw new Error("number of sub-containers mismatch");else _.each(newElts,function(container){const containerData=subContainers.shift(),containerElements=_detachElements(itemBody,containerData.elements);container.setElements(containerElements,containerData.body),self.initTextWidget(container,containerData.$original)}),_.defer(function(){callback.call(self)})}):callback.call(self)},ItemWidget.initTextWidget=function(container,$col){return TextWidget.build(container,$col,this.renderer.getOption("textOptionForm"),{})},ItemWidget.debug=function(options){if(options=options||{},options.state&&devTools.listenStateChange(),options.xml){const $code=$("<code>",{class:"language-markup"}),$pre=$("<pre>",{class:"line-numbers"}).append($code);$("#item-editor-wrapper").append($pre),devTools.liveXmlPreview(this.element,$code)}},ItemWidget}),define("tpl!taoMediaManager/qtiCreator/renderers/tpl/wrap",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){return"<div class=\"grid-row\"><div class=\"col-12\"></div></div>"},useData:!0})}),define("taoMediaManager/qtiCreator/renderers/Item",["jquery","lodash","taoQtiItem/qtiCommonRenderer/renderers/Item","taoMediaManager/qtiCreator/widgets/item/Widget","tpl!taoQtiItem/qtiCreator/tpl/item","tpl!taoMediaManager/qtiCreator/renderers/tpl/wrap"],function($,_,CommonRenderer,Widget,tpl,wrapTpl){"use strict";const CreatorItem=_.clone(CommonRenderer),_normalizeItemBody=function _normalizeItemBody($itemBody){return $itemBody.children().each(function(){const $child=$(this);$child.hasClass("grid-row")||$child.hasClass("qti-infoControl")||$child.wrap(wrapTpl())}),$itemBody};return CreatorItem.template=tpl,CreatorItem.render=function render(item,options){const $itemContainer=CommonRenderer.getContainer(item);return _normalizeItemBody($itemContainer.find(".qti-itemBody")),options=options||{},options.state="active",options.renderer=this,Widget.build(item,$itemContainer,this.getOption("itemOptionForm"),options)},CreatorItem}),define("taoMediaManager/qtiCreator/widgets/static/object/states/Active",["lodash","jquery","i18n","taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/Active","tpl!taoQtiItem/qtiCreator/tpl/forms/static/object","taoQtiItem/qtiCreator/widgets/helpers/formElement","taoQtiItem/qtiCreator/widgets/static/helpers/inline","ui/mediaEditor/mediaEditorComponent","ui/previewer","ui/resourcemgr","ui/tooltip"],function(_,$,__,stateFactory,Active,formTpl,formElement,inlineHelper,mediaEditorComponent){"use strict";var _Mathmin=Math.min;let mediaEditor=null,$panelObjectSize=null,$panelMediaSize=null;const _config={renderingThrottle:1e3,fileFilters:"image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/avi,video/ogv,video/mpeg,video/ogg,video/quicktime,video/webm,video/x-ms-wmv,video/x-flv,audio/mp3,audio/vnd.wav,audio/ogg,audio/vorbis,audio/webm,audio/mpeg,application/ogg,audio/aac,application/pdf"},ObjectStateActive=stateFactory.extend(Active,function(){this.initForm()},function(){mediaEditor&&mediaEditor.destroy(),mediaEditor=null,$panelObjectSize=null,$panelMediaSize=null,this.widget.$original.off("playerready"),this.widget.$form.empty()}),refreshRendering=_.throttle(function refreshRendering(widget){const obj=widget.element,$container=widget.$original,previewOptions={url:obj.renderer.resolveUrl(obj.attr("data")),mime:obj.attr("type")};obj.attr("height")&&(previewOptions.height=obj.attr("height")),obj.attr("width")&&(previewOptions.width=obj.attr("width")),previewOptions.url&&previewOptions.mime&&$container.previewer(previewOptions)},_config.renderingThrottle),setMediaSizeEditor=widget=>{var _Mathmax=Math.max,_Mathround=Math.round;const qtiObject=widget.element,type=qtiObject.attr("type");if(/video/.test(type)){const $container=widget.$original,mediaplayer=$container.data("player");let width=qtiObject.attr("width"),height=qtiObject.attr("height");if(!/%/.test(width)){const originalSize=mediaplayer.getMediaOriginalSize();if(!originalSize.width)return;const containerWidth=$container.closest(".widget-textBlock").width();if(!width)width=_Mathround(100/(containerWidth/originalSize.width)),height=0;else if(height){const scaleHeight=(_Mathmax(height||0,200)-$container.find(".mediaplayer .controls").height())/originalSize.height,scaleWidth=_Mathmax(width||0,200)/originalSize.width,scale=_Mathmin(scaleHeight,scaleWidth);width=_Mathround(100/(containerWidth/(scale*originalSize.width))),qtiObject.removeAttr("height"),height=0}}const onChange=_.debounce(nMedia=>{if(`${nMedia.width}%`!==qtiObject.attr("width")){const newWidth=`${_Mathround(nMedia.width)}%`;qtiObject.attr("width",newWidth),mediaplayer.resize(newWidth,"auto")}},200);mediaEditor&&mediaEditor.destroy(),mediaEditor=mediaEditorComponent($panelMediaSize,{$node:$container.find(".mediaplayer .media"),$container:$container,type:qtiObject.attr("type"),width,height,responsive:!0},{mediaDimension:{active:!0,showResponsiveToggle:!1}}).on("change",onChange)}},hideShowPanels=type=>{/video/.test(type)?($panelObjectSize.hide(),$panelMediaSize.show()):(mediaEditor&&mediaEditor.destroy(),$panelObjectSize.show(),$panelMediaSize.hide())},_initUpload=function(widget){const $form=widget.$form,options=widget.options,qtiObject=widget.element,$uploadTrigger=$form.find("[data-role=\"upload-trigger\"]"),$src=$form.find("input[name=src]"),_openResourceMgr=function _openResourceMgr(){$uploadTrigger.resourcemgr({title:__("Please select a media file from the resource manager. You can add files from your computer with the button \"Add file(s)\"."),appendContainer:options.mediaManager.appendContainer,mediaSourcesUrl:options.mediaManager.mediaSourcesUrl,browseUrl:options.mediaManager.browseUrl,uploadUrl:options.mediaManager.uploadUrl,deleteUrl:options.mediaManager.deleteUrl,downloadUrl:options.mediaManager.downloadUrl,fileExistsUrl:options.mediaManager.fileExistsUrl,params:{uri:options.uri,lang:options.lang,filters:_config.fileFilters},pathParam:"path",path:options.mediaManager.path,root:options.mediaManager.root,select:function(e,files){let file,type;files&&files.length&&(file=files[0].file,type=files[0].mime,qtiObject.attr("type",type),$src.val(file).trigger("change"))},open:function(){$src.data("$tooltip")&&$src.blur().data("$tooltip").hide()},close:function(){$src.blur()}})};$uploadTrigger.on("click",_openResourceMgr),$src.val()||_openResourceMgr()};return ObjectStateActive.prototype.initForm=function initForm(){const _widget=this.widget,$form=_widget.$form,qtiObject=_widget.element,baseUrl=_widget.options.baseUrl,$container=_widget.$original;$form.html(formTpl({baseUrl:baseUrl||"",src:qtiObject.attr("data"),alt:qtiObject.attr("alt"),height:qtiObject.attr("height"),width:qtiObject.attr("width")})),_initUpload(_widget),formElement.initWidget($form),$panelObjectSize=$(".size-panel",$form),$panelMediaSize=$(".media-size-panel",$form),hideShowPanels(qtiObject.attr("type")),$container.off("playerready").on("playerready",function(){setMediaSizeEditor(_widget)}),formElement.setChangeCallbacks($form,qtiObject,{src:function(object,value){value!==qtiObject.attr("data")&&(qtiObject.attr("data",value),qtiObject.removeAttr("width"),qtiObject.removeAttr("height"),$form.find("input[name=width]").val(""),$form.find("input[name=height]").val(""),$container.removeData("ui.previewer"),hideShowPanels(qtiObject.attr("type")),inlineHelper.togglePlaceholder(_widget),refreshRendering(_widget))},width:function(object,value){const val=parseInt(value,10);_.isNaN(val)?qtiObject.removeAttr("width"):qtiObject.attr("width",val),refreshRendering(_widget)},height:function(object,value){const val=parseInt(value,10);_.isNaN(val)?qtiObject.removeAttr("height"):qtiObject.attr("height",val),refreshRendering(_widget)},alt:function(qtiObjectAlt,value){qtiObjectAlt.attr("alt",value)},align:function(qtiObjectAlign,value){inlineHelper.positionFloat(_widget,value)}})},ObjectStateActive}),define("taoMediaManager/qtiCreator/widgets/static/object/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/object/states/Sleep","taoMediaManager/qtiCreator/widgets/static/object/states/Active"],function(factory,states){"use strict";return factory.createBundle(states,arguments)}),define("taoMediaManager/qtiCreator/widgets/static/object/Widget",["taoQtiItem/qtiCreator/widgets/static/Widget","taoMediaManager/qtiCreator/widgets/static/object/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/media","taoQtiItem/qtiCreator/widgets/static/helpers/inline"],function(Widget,states,helper,toolbarTpl,inlineHelper){"use strict";const ObjectWidget=Widget.clone();return ObjectWidget.initCreator=function initCreator(){this.registerStates(states),Widget.initCreator.call(this),inlineHelper.togglePlaceholder(this)},ObjectWidget.getRequiredOptions=function getRequiredOptions(){return["baseUrl","uri","lang","mediaManager"]},ObjectWidget.buildContainer=function buildContainer(){return helper.buildBlockContainer(this),this},ObjectWidget.createToolbar=function createToolbar(){return helper.createToolbar(this,toolbarTpl),this},ObjectWidget}),define("taoMediaManager/qtiCreator/renderers/Object",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Object","taoMediaManager/qtiCreator/widgets/static/object/Widget"],function(_,Renderer,Widget){"use strict";const CreatorObject=_.clone(Renderer);return CreatorObject.render=function render(object,options){Renderer.render(object),options=options||{},options.baseUrl=this.getOption("baseUrl"),options.uri=this.getOption("uri"),options.lang=this.getOption("lang"),options.mediaManager=this.getOption("mediaManager"),options.assetManager=this.getAssetManager(),Widget.build(object,Renderer.getContainer(object),this.getOption("bodyElementOptionForm"),options)},CreatorObject}),define("taoMediaManager/qtiCreator/widgets/static/table/states/Active",["lodash","jquery","i18n","ckeditor","ui/tableModel","taoQtiItem/qtiCreator/widgets/states/factory","taoMediaManager/qtiCreator/widgets/static/states/Active","taoQtiItem/qtiCreator/widgets/static/table/components/tableActions","taoMediaManager/qtiCreator/editor/ckEditor/htmlEditor","taoQtiItem/qtiCreator/editor/gridEditor/content","taoQtiItem/qtiCreator/widgets/helpers/formElement","tpl!taoQtiItem/qtiCreator/tpl/forms/static/table"],function(_,$,__,ckEditor,tableModelFactory,stateFactory,Active,tableActionsFactory,htmlEditor,contentHelper,formElement,formTpl){"use strict";function replaceElementByItsContent($elem){$elem.children().length?$elem.children(0).unwrap():$elem.replaceWith($elem.html())}function getChangeCallback(container){return _.throttle(function(data){const $tableTagContent=$(data).children(),$pseudoContainer=$("<div>").html($tableTagContent),newBody=contentHelper.getContent($pseudoContainer);container.body(newBody)},400)}function addClassOnCurrentRow(editor,className){const currentCellPos=getCurrentCellPos(editor);if(currentCellPos){const $currentCol=tableModel.getRowCells(currentCellPos.y);$currentCol.addClass(className)}}function addClassOnCurrentCol(editor,className){const currentCellPos=getCurrentCellPos(editor);if(currentCellPos){const $currentCol=tableModel.getColCells(currentCellPos.x);$currentCol.addClass(className)}}function clearCellClasses($editable,className){$editable.find("th, td").removeClass(className)}function updateTable(editor,$editableContainer){tableModel.update(),1===tableModel.getRowCount()?rowActions.hideDelete():rowActions.showDelete(),1===tableModel.getColCount()?colActions.hideDelete():colActions.showDelete(),displayTableActions(editor,$editableContainer)}function hideTableActions(){colActions&&colActions.hide(),rowActions&&rowActions.hide()}function displayTableActions(editor,$tableContainer){const selectedCells=getSelection(editor);if(selectedCells&&1!==selectedCells.length)hideTableActions();else{const $currentCell=$(selectedCells[0].$);colActions.show().hAlignWith($currentCell,"center").vAlignWith($tableContainer,"top"),rowActions.show().hAlignWith($tableContainer,"left").vAlignWith($currentCell,"center")}}function getCurrentCellPos(editor){const selectedCells=getSelection(editor);if(selectedCells&&1===selectedCells.length){const currentCell=selectedCells[0].$;return{x:currentCell.cellIndex,y:currentCell.parentNode.rowIndex}}}function getSelection(editor){const selection=editor.getSelection(),tabletools=window.CKEDITOR.plugins.tabletools;if(selection&&tabletools)return tabletools.getSelectedCells(selection)}let tableModel,colActions,rowActions;const css={deleteColRow:"hoverDelete",insertRowAfter:"insertRowAfter",insertColAfter:"insertColAfter",hAlignCenter:"table-center",hAlignRight:"table-right"},TableStateActive=stateFactory.extend(Active,function create(){this.initForm(),this.buildEditor()},function exit(){const $editableContainer=this.widget.$container,$caption=$("caption",$editableContainer);if(1<$caption.length){const $first=$caption.first();$caption.each(function(i){if(0<i){const $curCap=$(this);"<br>"!==$first.html()&&$first.append("<br>"),$first.append($curCap),replaceElementByItsContent($curCap)}}),$first.focus()}const $paragraphsInCaption=$("caption > p",$editableContainer);0<$paragraphsInCaption.length&&$paragraphsInCaption.each(function(){const $p=$(this),classNames=$p.attr("class");classNames&&($caption.removeClass(),$caption.addClass(classNames)),replaceElementByItsContent($p)}),this.widget.$form.empty(),this.destroyEditor()});return TableStateActive.prototype.initForm=function initForm(){const _widget=this.widget,$form=_widget.$form,table=_widget.element,$container=_widget.$container,hAlignOptions=[{name:__("Left"),value:"left"},{name:__("Center"),value:"center",selected:table.hasClass(css.hAlignCenter)},{name:__("Right"),value:"right",selected:table.hasClass(css.hAlignRight)}];$form.html(formTpl({hAlignOptions:hAlignOptions})),formElement.initWidget($form),formElement.setChangeCallbacks($form,table,{hAlign:function(t,value){switch(hideTableActions(),t.removeClass(css.hAlignRight),t.removeClass(css.hAlignCenter),$container.removeClass(`${css.hAlignRight} ${css.hAlignCenter}`),value){case"center":{t.addClass(css.hAlignCenter),$container.addClass(css.hAlignCenter);break}case"right":{t.addClass(css.hAlignRight),$container.addClass(css.hAlignRight);break}}}})},TableStateActive.prototype.buildEditor=function buildEditor(){const _widget=this.widget,container=_widget.element.getBody(),$itemPanel=_widget.getAreaBroker().getItemPanelArea(),$editableContainer=_widget.$container,$editable=$editableContainer.find(".qti-table-container"),$tablePropTrigger=$editableContainer.find("[data-role=\"cke-table-properties\"]"),areaBroker=_widget&&_widget.getAreaBroker&&_widget.getAreaBroker(),$toolbarArea=areaBroker&&areaBroker.getToolbarArea&&areaBroker.getToolbarArea();$editableContainer.attr("data-html-editable-container",!0),$editable.attr("data-html-editable",!0),htmlEditor.hasEditor($editableContainer)||htmlEditor.buildEditor($editableContainer,{placeholder:"",change:getChangeCallback(container),removePlugins:"magicline",data:{container:container,widget:_widget},blur:function(){_widget.changeState("sleep")}}),$editable.on("editorready.tableActive",function(event,editor){tableModel=tableModelFactory($editable.find("table")),$tablePropTrigger.on("click.tableActive",function openTableProperties(e){e.stopPropagation(),hideTableActions(),editor.execCommand("taoqtitableProperties")}),colActions=tableActionsFactory({insertCol:!0,deleteTitle:"Delete column"}).on("delete",function(){editor.execCommand("columnDelete"),updateTable(editor,$editableContainer),hideTableActions()}).on("deleteMouseEnter",function(){addClassOnCurrentCol(editor,css.deleteColRow)}).on("deleteMouseLeave",function(){clearCellClasses($editable,css.deleteColRow)}).on("insertCol",function(){editor.execCommand("columnInsertAfter"),clearCellClasses($editable,css.insertColAfter),this.trigger("insertColMouseEnter"),updateTable(editor,$editableContainer)}).on("insertColMouseEnter",function(){addClassOnCurrentCol(editor,css.insertColAfter)}).on("insertColMouseLeave",function(){clearCellClasses($editable,css.insertColAfter)}).render($itemPanel),rowActions=tableActionsFactory({insertRow:!0,deleteTitle:"Delete row"}).on("delete",function(){editor.execCommand("rowDelete"),updateTable(editor,$editableContainer),hideTableActions()}).on("deleteMouseEnter",function(){addClassOnCurrentRow(editor,css.deleteColRow)}).on("deleteMouseLeave",function(){clearCellClasses($editable,css.deleteColRow)}).on("insertRow",function(){editor.execCommand("rowInsertAfter"),clearCellClasses($editable,css.insertRowAfter),this.trigger("insertRowMouseEnter"),updateTable(editor,$editableContainer)}).on("insertRowMouseEnter",function(){addClassOnCurrentRow(editor,css.insertRowAfter)}).on("insertRowMouseLeave",function(){clearCellClasses($editable,css.insertRowAfter)}).render($itemPanel),displayTableActions(editor,$editableContainer),$editableContainer.on("keyup.tableActive mouseup.tableActive",function(){displayTableActions(editor,$editableContainer);const currentSelection=getSelection(editor),$toolbars=$toolbarArea.find(".cke_toolbar");1<currentSelection.length?($toolbars.eq(1).hide(),$toolbars.eq(2).hide()):($toolbars.eq(1).show(),$toolbars.eq(2).show())})}).on("editordestroyed.tableActive",function(){$tablePropTrigger.length&&$tablePropTrigger.off(".tableActive")})},TableStateActive.prototype.destroyEditor=function destroyEditor(){const _widget=this.widget,$editableContainer=_widget.$container,$editable=$editableContainer.find("[data-html-editable=\"true\"]");clearCellClasses($editable,css.insertColAfter),clearCellClasses($editable,css.insertRowAfter),clearCellClasses($editable,css.deleteColRow),htmlEditor.destroyEditor($editableContainer),$editableContainer.off(".tableActive"),$editable.off(".tableActive"),$editable.attr("data-html-editable",!1),$editableContainer.attr("data-html-editable-container",!1),tableModel=null,colActions&&(colActions.destroy(),colActions=null),rowActions&&(rowActions.destroy(),rowActions=null)},TableStateActive}),define("taoMediaManager/qtiCreator/widgets/static/table/states/states",["taoQtiItem/qtiCreator/widgets/states/factory","taoQtiItem/qtiCreator/widgets/static/states/states","taoQtiItem/qtiCreator/widgets/static/table/states/Sleep","taoMediaManager/qtiCreator/widgets/static/table/states/Active"],function(factory,states){"use strict";return factory.createBundle(states,arguments)}),define("taoMediaManager/qtiCreator/widgets/static/table/Widget",["jquery","taoQtiItem/qtiCreator/widgets/static/Widget","taoMediaManager/qtiCreator/widgets/static/table/states/states","taoQtiItem/qtiCreator/widgets/static/helpers/widget","tpl!taoQtiItem/qtiCreator/tpl/toolbars/table"],function($,Widget,states,helper,toolbarTpl){"use strict";var TableWidget=Widget.clone();return TableWidget.initCreator=function(){this.registerStates(states),Widget.initCreator.call(this)},TableWidget.buildContainer=function(){var table=this.element;return helper.buildBlockContainer(this),table.attr("class")&&this.$container.addClass(table.attr("class")),this},TableWidget.createToolbar=function(){const self=this,$tlb=$(toolbarTpl({serial:this.serial,state:"active"}));return this.$container.append($tlb),$tlb.find("[data-role=\"delete\"]").on("click.widget-box",function(e){e.stopPropagation(),self.changeState("deleting")}),this},TableWidget}),define("taoMediaManager/qtiCreator/renderers/Table",["lodash","taoQtiItem/qtiCommonRenderer/renderers/Table","taoMediaManager/qtiCreator/widgets/static/table/Widget","tpl!taoQtiItem/qtiCreator/tpl/table"],function(_,Renderer,Widget,tpl){"use strict";const CreatorTable=_.clone(Renderer);return CreatorTable.template=tpl,CreatorTable.render=function render(table,options){Widget.build(table,Renderer.getContainer(table),this.getOption("bodyElementOptionForm"),options||{})},CreatorTable}),define("tpl!taoMediaManager/qtiXmlRenderer/tpl/item",["handlebars"],function(hb){return hb.template({1:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,data&&lookupProperty(data,"key"),{name:"if",hash:{},fn:container.program(2,data,0),inverse:container.program(4,data,0),data:data,loc:{start:{line:3,column:24},end:{line:3,column:86}}}))?"":stack1)+" "},2:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},helper;return"xmlns:"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"key")||data&&lookupProperty(data,"key"))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"key",hash:{},data:data,loc:{start:{line:3,column:42},end:{line:3,column:50}}}):helper))+"=\""+container.escapeExpression(container.lambda(depth0,depth0))+"\""},4:function(container,depth0,helpers,partials,data){return"xmlns=\""+container.escapeExpression(container.lambda(depth0,depth0))+"\""},6:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return null==(stack1=(lookupProperty(helpers,"join")||depth0&&lookupProperty(depth0,"join")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"attributes"),"="," ","\"",{name:"join",hash:{},data:data,loc:{start:{line:4,column:22},end:{line:4,column:55}}}))?"":stack1},8:function(container,depth0,helpers,partials,data){return"        <div class=\"empty\"></div>\n"},10:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1,helper;return"        "+(null==(stack1=(helper=null==(helper=lookupProperty(helpers,"body")||(null==depth0?depth0:lookupProperty(depth0,"body")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"body",hash:{},data:data,loc:{start:{line:8,column:8},end:{line:8,column:18}}}):helper))?"":stack1)+"\n"},compiler:[8,">= 4.3.0"],main:function(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<div\n    "+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"namespaces"),{name:"each",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:3,column:4},end:{line:3,column:96}}}))?"":stack1)+"\n    "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"attributes"),{name:"if",hash:{},fn:container.program(6,data,0),inverse:container.noop,data:data,loc:{start:{line:4,column:4},end:{line:4,column:62}}}))?"":stack1)+">\n"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"empty"),{name:"if",hash:{},fn:container.program(8,data,0),inverse:container.program(10,data,0),data:data,loc:{start:{line:5,column:4},end:{line:9,column:11}}}))?"":stack1)+"</div>"},useData:!0})}),define("taoMediaManager/qtiXmlRenderer/renderers/Item",["lodash","tpl!taoMediaManager/qtiXmlRenderer/tpl/item"],function(_,tpl){"use strict";return{qtiClass:"assessmentItem",template:tpl,getData:function getData(item,data){const defaultData={class:data.attributes.class||"",namespaces:item.getNamespaces(),schemaLocations:"",xsi:"xsi:",empty:item.isEmpty()};return _.forIn(item.getSchemaLocations(),(url,uri)=>{defaultData.schemaLocations+=`${uri} ${url} `}),defaultData.schemaLocations=defaultData.schemaLocations.trim(),data=_.merge({},data,defaultData),delete data.attributes.title,delete data.attributes.adaptive,delete data.attributes.timeDependent,delete data.attributes.identifier,data.attributes=_.mapValues(data.attributes,function(val){return _.isString(val)?_.escape(val):val}),data}}}),function(c){var d=document,a="appendChild",i="styleSheet",s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0].appendChild(s),s.styleSheet?s.styleSheet.cssText=c:s.appendChild(d.createTextNode(c))}(".previewer{position:relative}.previewer iframe{min-height:400px;width:100%}.previewer .previewer-component{background-color:#fff;text-align:initial}.previewer .previewer-component .item-previewer-scope{height:calc(100vh - 250px)}.previewer .previewer-component .item-previewer-scope .action-bar,.previewer .previewer-component .item-previewer-scope .test-sidebar{display:none}.previewer.no-background{background:none}#item-editor-scope .left-bar .tool-group ._accordion{display:none}#item-editor-scope .focus-border{box-shadow:1px 1px 3px 2px #3e7da7}#item-editor-scope .qti-itemBody.item-editor-drop-area{margin-top:0}#item-editor-scope .qti-item{padding:20px}#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-smaller,#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-larger{background:none;color:#000;height:21px;width:20px}#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-smaller{margin-left:30px}#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-smaller:before{font-size:1.2rem}#item-editor-scope .item-editor-sidebar #item-editor-font-size-changer .icon-larger:before{font-size:1.8rem}#item-editor-scope .item-editor-sidebar .item-editor-color-picker .color-trigger{background:none}#item-editor-scope .item-editor-sidebar .item-editor-color-picker .reset-button{top:0}#item-editor-scope .item-editor-sidebar .reset-group .reset-button{background:none;color:#000}#item-editor-scope .item-editor-sidebar #style-sheet-toggler .file-label{cursor:default}#item-editor-scope .item-editor-sidebar #style-sheet-toggler .file-label:hover{color:inherit}#item-editor-scope .item-editor-sidebar #style-sheet-toggler [data-custom-css=custom-css] span:last-child{cursor:default}#mediaManager .stylesheets .file-selector ul{display:flex;flex-direction:column-reverse;justify-content:flex-end}#mediaManager .stylesheets .file-selector li{order:2;box-sizing:initial;margin:0 0 5px 0}#mediaManager .stylesheets .file-selector li .actions{text-align:right}#mediaManager .stylesheets .file-selector li[data-file=\"/tao-user-styles.css\"]{order:1;margin:5px 0}#mediaManager .stylesheets .file-selector li[data-file=\"/tao-user-styles.css\"]:before{border-top:1px solid #ddd;width:100%;left:0;text-indent:8px;top:-5px;line-height:2.8}#mediaManager .stylesheets .file-selector li[data-file=\"/tao-user-styles.css\"] .actions a.tlb-button-off{display:none}#mediaManager .stylesheets .file-selector li[data-file=\"/tao-user-styles.css\"] .actions a.download{display:block}#mediaManager .stylesheets .file-selector .files>li[data-file=\"/tao-user-styles.css\"]:only-child:before{border:none}#mediaManager .stylesheets .file-preview h2[data-toggle*=\".actions\"]{display:none}#mediaManager .stylesheets .file-preview h2[data-toggle*=\".actions\"]+.actions{display:none}div.item-editor-item{border-color:rgba(0,0,0,0)}\n\n/*# sourceMappingURL=../../../taoMediaManager/views/css/media.css.map */"),define("taoMediaManager/loader/taoMediaManager.bundle",function(){}),define("taoMediaManager/loader/taoMediaManager.min",["taoItems/loader/taoItemsRunner.min","taoTests/loader/taoTestsRunner.min","taoQtiItem/loader/taoQtiItemRunner.min","taoQtiItem/loader/taoQtiItem.min","taoQtiTestPreviewer/loader/qtiPreviewer.min"],function(){});
//# sourceMappingURL=taoMediaManager.min.js.map